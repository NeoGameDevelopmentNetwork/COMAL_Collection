KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK ░ A TEST.$тHISA TEST.$тHIS ISTEST.$тHIS IS A нORMAL USAGE IS:RUN "KWIC"$<DOCUMENT >TEMP1RUN "SORT"$<TEMP1 >TEMP2RUN "UNROTATE"$<TEMP2CHARACTER $; UNFOLDING INVOLVESWRITING FROM THE END OF THE LINE DOWNTO BUT NOT INCLUDING THE FOLD CHARACTERSTARTING IN COLUMN 39 OF THE OUTPUTLINE, WRAPPING CHARACTERS THAT WOULDAPPEAR BEFORE COLUMN 1 AROUND TO THEEND OF THE LINE, THEN WRITING THE p             тHIS IS  A TEST.               тHIS  IS A TEST.          тHIS IS A  TEST.    тHIS IS A TEST. ?K OR NEWLINE. еьампле$а SINGLE LINE OF INPUT.<ендфиле>5KKKKKKпрограмUNIQUE  DELETE ADJACENT DUPLICATE LINES усагеRUN "UNIQUE"$[<STDIN] [>STDOUT] фунцтионUNIQUE WRITES TO ITS OUTPUT ONLY THEFIRST LINE FROM EACH GROUP OF ADJACENTIDENTICAL INPUT LINES.  иT IS MOSTUSEFUL FOR TEXT THAT HAS BEEN SORTEDTO BRIпрограмUNROTATE  FORMAT LINES FOR квиц INDEX усагеRUN "UNROTATE"$[<STDIN] [>STDOUT] фунцтионUNROTATE READS ITS INPUT A LINE AT ATIME AND WRITES AN UNFOLDED VERSION TOITS OUTPUT.  а LINE IS FOLDED IF ITCONTAINS WITHIN A AN INSTANCE OF THEFOLD REMAINDER OF THE LINE STARTING ATCOLUMN 41 AND WRAPPING AROUND AT COLUMN80 IF NECESSARY. UNROTATE IS USED WITH KWIC AND SORT TOPRODUCE A кEYвORD иN цONTEXT, OR квиц,INDEX. еьампле$A TEST.$тHIS ISIS A TEST.$тHISTEST.$тHIS IS AтHIS IS A TEST.$програмWORDCOUNT  COUNT WORDS IN INPUT усагеRUN "WORDCOUNT"$[<STDIN] [>STDOUT] фунцтионWORDCOUNT COUNTS THE WORDS IN ITS INPUTAND WRITES THE TOTAL AS A LINE OF TEXTTO ITS OUTPUT.  а WORD IS A MAXIMALSEQUENCE OF CHARACTERS NOT CONTAINING ABLANKKKKKK КNG IDENTICAL LINES TOGETHER; INTHIS CASE IT PASSES THROUGH ONLYUNIQUE INSTANCES OF INPUT LINES. еьамплетO ELIMINATE DUPLICATE LINES IN THEOUTPUT OF A PROGRAM:RUN "PROGRAM"$>TEMP1RUN "SORT"$<TEMP1 >TEMP2RUN "UNIQUE"$<TEMP2
програмEXPAND  EXPAND COMPRESSED INPUT усагеRUN "EXPAND"$[<STDIN] [>STDOUT] фунцтионEXPAND COPIES ITS INPUT, WHICH HASPRESUMERABLY BEEN ENCODED BY COMPRESS,TO ITS OUTPUT, REPLACING CODE SEQUENCES^NC BY THE REPEATED CHARACTERS THEYSTAND FOR SOWING ELEMENTS:C      LITERAL CHARACTER C?      ANY CHARACTER EXCEPT NEWLINE%      BEGINNING OF LINE$      END OF LINE (NULL STRING BEFORE         NEWLINE)[...]  CHARACTER CLASS (ANY ONE OF         THESE CHARACTERS)[!...] NEGATED CHARACTER CLASS (T AT BEGINNING OF LINE$ NOT AT END* AT BEGINNING а CHARACTER CLASS CONSISTS OF ZERO ORMORE OF THE FOLLOWING ELEMENTS,SURROUNDED BY [ AND ]:C     LITERAL CHARACTER C, INCLUDING [C1-C2 RANGE OF CHARACTERS (DIGITS,         LOWER- OR UPPER-CASE CHAR ╟HECHARACTER @ FOLLWED BY A SINGLECHARACTER:@N NEWLINE@S SPACE@C C (INCLUDING @) еьамплетO PRINT LINES ENDING IN A цомалKEYWORD OR IDENTIFIER:$[A-Zа-з][A-Zа-з0-9']*$S FILLED TO A UNIFORM RIGHTMARGIN.  иNPUT TEXT LINES MAY HAVEINTERSPERSED AMONG THEN COMMAND LINESTHAT ALTER THIS DEFAULT MODE OFFORMATTING.  а COMMAND LINE CONSISTS OFA LEADING PERIOD, FOLLOWED BY A TWOLETTER CODE, POSSIBLY WITH OPTIONALARGUMENTSERIC ARGUMANT.  иFA NUMERIC ARGUMENT IS PRECEDED BY A +OR -, THE CURRENT VALUE IS CHANGED BYTHIS AMOUNT; OTHERWISE THE ARGUMENTREPRESENTS THE NEW VALUE.  иF NOARGUMENT IS GIVEN, THE DEFAULT VALUE ISUSED. COMMAND BREAK DEFAULT FUNCTION.BP N     Y=1     LINE SPACING IS N.NF       Y           STOP FILLING.NL N     Y           SKIP TO NEW PAGE                      IF NOT N LINES                      LEFT ON CURRENT                      PAGE.PA N     Y   N=1     PARAGRAPH.PL N     N   N=66    ЙPUT LINE THAT BEGINSWITH BLANKS CAUSES A BREAK AND ISWRITTEN TO THE OUTPUT WITH THE LEADINGBLANKS PRESERVED.  тHUS A DOCUMENTFORMATTED IN THE CONVENTIONAL MANNER BYHAND WILL RETAIN ITS ORIGINAL PARAGRAPHBREAKS AND INDENTATION. ╟LUDED FILES MAY CONTAINFURTHER #INCLUDE LINES, TO AN ARBITRARYDEPTH. бугса FILE THAT INCLUDES ITSELF WILL NOT BEDIAGNOSED, BUT WILL EVENTUALLY CAUSESOMETHING TO BREAK. G FROM THAT STRING THROUGH THEEND OF THE LINE, FOLLOWED BY THE FOLDCHARACTER $, FOLLOWED BY THE BEGINNINGOF THE LINE. KWIC IS USED WITH SORT AND UNROTATE TOPRODUCE A кEYвORD иN цONTEXT, OR квицINDEX. еьампле$тHIS IS A TEST.тHIS IS A TEST.$IS THAT THE TEXT OITPUTEXACCTLY MATCHES THAT WHICH WASORIGINALLY ENCODED.  тHE OCCURRENCE OFTHE WARNING CHARACTER ^ IN THE INPUTMEANS THAT THE NEXT CHARACTER IS AREPETITION COUNT; 'а' CALLS FOR ONEINSTANCE OF THE FOLLOWING CHARACTER,'б' CALLS FOR TWпрограмFIND  FIND PATTERNS IN TEXT усагеRUN "FIND"$PATTERN [<STDIN] [>STDOUT] фунцтионFIND READS ITS INPUT A LINE AT A TIMEAND WRITES TO ITS OUTPUT THOSE LINESTHAT MATCH THE SPECIFIED TEXT PATTERN.а TEXT PATTERN IS A CONCATENATION OFTHE FOLLOALL BUT         THESE CHARACTERS)*      CLOSURE (ZERO OR MORE         OCCURRENCES OF THE PREVIOUS         PATTERN)@C     ESCAPED CHARACTER сPECIAL MEANING ON CHARACTERS IN ATEXT PATTERN IS LOST WHEN ESCAPED,INSIDE [...] (EXCEPT @]), OR FOR:% NOS)!     NEGATED CHARACTER CLASS IF AT         BEGINNING@C    ESCAPED CHARACTER (@! @S @N ETC) сPECIAL MEANING OF CHARACTERS IN ACHARACTER CLASS IS LOST WHEN ESCAPEDOR FOR:! NOT AT BEGINNING- AT BEGINNING OR END аN ESCAPE SEQUENCE CONSISTS OF TпрограмFORMAT  PRODUCE FORMATTED OUTPUT усагеRUN "FORMAT"$[<STDIN] [>STDOUT] фунцтионFORMAT READS ITS INPUT A LINE AT A TIMEAND WRITES A NEATLY FORMATTED VERSIONOF THE INPUT TEXT TO THE OUTPUT, WITHPAGE HEADERS AND FOOTERS AND WITHOUTPUT LINE FOLLOWING THE FIRST SEQUENCEOF BLANKS. цERTAIN COMMAND CAUSE A 'BREAK' IN THEPROCESSING IF INPUT TEXT LINES, I.E.ANY PARTIALLY FILLED LINE IS OUTPUT ANDA NEW LINE IS BEGUN.  иN THE FOLLOWINGCOMMAND SUMMARY, THE LETTER N STANDSFOR AN OPTIONAL NUM   N=+1    BEGIN PAGE N.BR       Y           CAUSE BREAK.CE N     Y   N=1     CENTRE N LINES.FI       Y           START FILLING.FO STR   N   EMPTY   FOOTER TITLE.HE STR   N   EMPTY   HEADER TITLE.IN N     N   N=0     INDENT N SPACES.LS N     N   N PAGE LENGTH.RM N     N   N=80    RIGHT MARGIN.SP N     Y   N=1     SPACE N LINES OR                      TO END OF PAGE.TI N     Y   N=0     TEMPORARY INDENT а BLANK INPUT LINE CAUSES A BREAK ANDIS PASSED TO THE OUTPUT UNCHANGED.сIMILARLY, AN INпрограмINCLUDE  INCLUDE COPIES OF SUBFILES усагеRUN "INCLUDE"$[<STDIN] [>STDOUT] фунцтионINCLUDE COPIES ITS INPUT TO ITS OUTPUTUNCHANGED, EXCEPT THAT EACH LINEBEGINNING   #INCLUDE FILENAMEIS REPLACED BY THE CONTENTS OF THE FILEFILENAME.  иNC	програмKWIC  PRODUCE LINES FOR квиц INDEX усагеRUN "KWIC"$[<STDIN] [>STDOUT] фунцтионKWIC WRITES ONE OR MORE FOLDED VERSIONSOF EACH INPUT LINE TO ITS OUTPUT.  аLINE IS FOLDED AT THE BEGINNING OF EACHLPHANUMERIC STRING WITHIN THE LINE BYWRITIN ≈O, AND SO ON UP TO 'з'. еьампле$иTEM^д нAME^и жALUEиTEM    нAME         жALUE1^г CAR^й $7,000.00 ^а^1       CAR          $7,000.00 ^<ендфиле> О)+10310     ендфор I0320     фор J:=1 то MAXOUT-1 до0330       иф OUTBUF$(J)<>" " тхен I:=J0340     ендфор J0350     OUTBUF$(I+1):=""0""0360     PUTSTR(OUTBUF$,6)0370     PUTC(""13"")0380   ендвхиле 0390 ендпроц UNROTATE0400 //програмCOMPARE  COMPARE FILES FOR EQUALITY усагеRUN "COMPARE"$FILE1 FILE2 [<STDIN] [>STDOUT] фунцтионCOMPARE PERFORMS A LINE-BY-LINECOMPARISON OF FILE1 AND FILE2, PRINTINGEACH PAIR OF DIFFERING LINES, PRECEDEDBY A LINE CONTAINING THE OFFENDINGED,REPLACED, OR DELETED FROM THE ARCHIVE. -CMD IS A CODE THAT DETERMINES THEOPERATION TO BE PERFORMED:-C CREATE NEW ARCHIVE WITH NAMED FILES-D DELETE NAMED FILES FROM ARCHIVE-P PRINT NAMED FILER ON OUTPUT-T PRINT TABLE OF ARCHIVE CONTENTS-U UPDAHIVE, EXCEPT FOR THE DELETECOMMAND -D, WHICH IS NOT SO RASH. ARCHIVE COMPLAINS IF A FILE IS NAMEDMORE THAN ONCE OR CANNOT BE ACCESSED. тHE -T COMMAND WRITES ONE LINE TO THEOUTPUT FOR EACH NAMED MEMBER,CONSISTING OF THE MEMBER NAME AND THEFILE LEOM, ANDEXTRACT WRITES TO, FILES WHOSE NAMESARE THE SAME AS THE MEMBER NAMES IN THEARCHIVE. аN INTERMEDIATE VERSION OF THE NEWARCHIVE FILE IS FIRST WRITTEN TO THEFILE ARTEMP; HENCE THIS FILENAME SHOULDBE AVOIDED. аN ARCHIVE IS A CONCATENATION OF OLD2 NEW1$-T ARCHFILEXISTENTNEWSTUFF IMPLIES DELETION OF THEMATCHED STRING.  тHE PATTERNS ACCEPTEDBY CHANGE ARE THE SAME AS THOSE USED BYFIND. тHE REPLACEMENT STRING NEWSTUFFCONSISTS OF ZERO OR MORE OF THEFOLLOWING ELEMENTS:C   LITERAL CHARACTER&   DITTO, I.E. WHATIS:ONE LOWER- OR UPPER-CASE CHARACTER   FOLLOWED BYZERO OR MORE LOWER- OR UPPER-CASECHARACTERS OR A DIGIT 0 TO 9 OR '   FOLLOWED BYZERO OR MORE SPACES   FOLLOWED BYPLUS OR MINUS   FOLLOWED BYZERO OR MORE SPACES   FOLLOWED BYONE LOWER- OR UPPE Ч LINENUMBER AND A COLON.  иF THE FILES AREIDENTICAL, NO OUTPUT IS PRODUCED.  иFONE FILE IS A PREFIX OF THE OTHER,COMPARE REPORTS END OF FILE ON THESHORTER FILE. еьампле$OLD NEW бугсCOMPARE CAN PRODUCE VOLUMINOUS OUTPUTFOR SMALL DIFFERENCES. ╒BY A невлине CHARACTER, THE TOTAL COUNTIS THE NUMBER OF LINES PLUS THE NUMBEROF CHARACTERS WITHIN EACH LINE. еьампле$а SINGLE LINE OF INPUT.<ендфиле>240010 PROG$:="вордцоунт"0020 //0030 //WORDCOUNT-COUNT WORDS ON INPUT0040 //0050 INIT //INITIALISE0060 WORDCOUNT0070 FINIT //FINALISE0080 енд 0090 //0100 //WORDCOUNT-COUNT WORDS ON INPUT0110 //0120 проц WORDCOUNT 0130   дим C$ оф 10140   WC:=0 ,UTC(""13"")0260 ендпроц WORDCOUNT0270 //програмARCHIVE  MAINTAIN FILE ARCHIVE усагеRUN "ARCHIVE"$-CMD ANAME [FILE...] [<STDIN][>STDOUT] фунцтионARCHIVE MANAGES ANY NUMBER OF MEMBERFILES IN A SINGLE FILE, ANAME, WITHSUFFICIENT INFORMATION THAT MEMBERSMAY BE SELECTIVELY ADDED, EXTRACTTE NAMED FILES OR ADD AT END-X EXTRACT NAMED FILES FROM ARCHIVE иN EACH CASE, THE 'NAMED FILES' ARETHE ZERO OR MORE FILENAMES GIVEN ASARGUMENTS FOLLOWING ANAME.  иF NOARGUMENTS FOLLOW, THEN THE 'NAMEDFILES' ARE TAKEN AS ALL OF THE FILESIN THE ARCNGTH IN CHARACTERS SEPERATED BYA SPACE. тHE CREATE COMMAND -C MAKES A NEWARCHIVE CONTAINING THE NAMED MEMBERS. тHE UPDATE COMMAND -U REPLACES EXISTINGNAMED MEMBERS AND ADDS NEW FILES ONTOTHE END OF AN EXISTING ARCHIVE. цREATE AND UPDATE READ FR ZEROOR MORE ENTRIES, EACH CONSISTING OF AHEADER AND AN EXACT COPY OF THEORIGINAL FILE.  тHE HEADER FORMAT IS   -H- NAME LENGTH еьамплетO REPLACE TWO FILES IN AN EXISTINGARCHIVE, ADD A NEW ONE, THEN PRINT THETABLE OF CONTENTS:$-U ARCHFILE OLD1 програмCHANGE  CHANGE PATTERNS IN TEXT усагеRUN "CHANGE"$PATTERN [NEWSTUFF] [<STDIN] [>STDOUT] фунцтионCHANGE COPIES ITS INPUT TO ITS OUTPUTEXCEPT THAT EACH NON-OVERLAPPING STRINGTHAT MATCHES PATTERN IS REPLACED BY THESTRING NEWSTUFF.  а NON-EEVER WAS MATCHED@C  ESCAPED CHARACTER еьамплетO PARENTHESIZE ALL SUMS ANDDIFFERENCES OF IDENTIFIERS:$[A-Zа-з][A-Zа-з0-9']*[@S]*[+-][@S]*[A-Zа-з][A-Zа-з0-9']* (&) тHIS WOULD CHANGE   NEXT'PAR1 + LASTTO   (NEXT'PAR1 + LAST) тHE PATTERN ABOVE  eR-CASE CHARACTER   FOLLOWED BYZERO OR MORE LOWER- OR UPPER-CASECHARACTERS OR A DIGIT 0 TO 9 OR '	програмCHARCOUNT  COUNT CHARACTERS IN INPUT усагеRUN "CHARCOUNT"$[<STDIN] [>STDOUT] фунцтионCHARCOUNT COUNTS THE CHARACTERS IN ITSINPUT AND WRITES THE TOTAL AS A SINGLELINE OF TEXT TO THE OUTPUT.  сINCE EACHLINE OF TEXT IS INTERNALLY DELIMITED0150   INWORD:=фалсе0160   вхиле GETC$(C$)<>цхр$(92) до0170     иф C$=" " ор C$=""13"" тхен0180       INWORD:=фалсе0190     елиф INWORD=фалсе тхен0200       INWORD:=труе0210       WC:+10220     ендиф 0230   ендвхиле 0240   PUTDEC(WC,1)0250   P
40   FD:=XCREATE(NAME$,MODE)9541   иф FD=0 тхен9542     PUTSTR(NAME$,7)9543     ERROR(": CAN'T CREATE FILE")9544   ендиф 9545   ретурн FD9546 ендфунц MUSTCREATE9547 //9548 //MUSTOPEN-OPEN A FILE OR DIE9549 //9550 фунц MUSTOPEN(NAME$,MODE) цлосеоф 150, C$ оф 1, NEGATE$ оф 10140   NEGATE$:="!"0150   иф GETARG(1,ARG$,150)=фалсе тхен ERROR("USAGE: FROMSET TOSET")0160   ALLBUT:=фалсе0170   иф ARG$(1)=NEGATE$ тхен ALLBUT:=труе0180   I:=10190   иф ALLBUT=труе тхен I:=20200   иф MAKESET(ARG$,I,   ERROR("FROMSET SHORTER THAN TOSET")0270   ендиф 0280   LASTTO:=LENGTH(TOSET$)0290   SQUASH:=фалсе0300   иф LENGTH(FROMSET$)>LASTTO ор ALLBUT=труе тхен SQUASH:=труе0310   репеат 0320     I:=XINDEX(FROMSET$,GETC$(C$),ALLBUT,LASTTO)0330     иф SQUен //TRANSLATE0410         PUTC(TOSET$(I))0420       елиф I=0 тхен //COPY0430         PUTC(C$)0440         //ELSE DELETE0450       ендиф 0460     ендиф 0470   унтил C$=цхр$(92)0480 ендпроц TRANSLIT0490 //0500 //XINDEX-CONDITIONALLY INVERT VALUE0   елсе 0610     ретурн LASTTO+10620   ендиф 0630 ендфунц XINDEX0640 //0650 //MAKESET-MAKE SET FROM INSET(K) IN OUTSET0660 //0670 фунц MAKESET(INSET$,K,реф OUTSET$,MAXSET) цлосед0680   импорт DODASH,ADDSTR0690   J:=10700   DODASH(""0"",INSET$,TA$,ISALPHANUM0780   вхиле SRC$(I)<>DELIM$ анд SRC$(I)<>""0"" до0790     иф SRC$(I)=цхр$(64) тхен0800       JUNK:=ADDSTR(META$(SRC$,I),DEST$,J,MAXSET)0810     елиф SRC$(I)<>"-" тхен0820       JUNK:=ADDSTR(SRC$(I),DEST$,J,MAXSET)0830     елиф J<=1 о ъ=ADDSTR(цхр$(K),DEST$,J,MAXSET)0890         ендфор K0900       ендиф 0910       I:+10920     елсе 0930       JUNK:=ADDSTR("-",DEST$,J,MAXSET)0940     ендиф 0950     I:+10960   ендвхиле 0970 ендпроц DODASH0980 //1500140   CUR:=10150   BUF$(1-CUR):=""0""0170   вхиле GETLINE(BUF$(CUR),5,150)=труе до0180     иф EQUAL(BUF$(CUR),BUF$(1-CUR))=фалсе тхен0190       PUTSTR(BUF$(CUR),6)0200       CUR:=1-CUR0210     ендиф 0220   ендвхиле 0230 ендпроц UNIQUE0240 / I:=LENGTH(INBUF$)-1 то F+1 степ -1 до0230       OUTBUF$(J):=INBUF$(I)0240       J:-10250       иф J<=0 тхен J:=MAXOUT-10260     ендфор I0270     J:=MIDDLE+10280     фор I:=1 то F-1 до0290       OUTBUF$(J):=INBUF$(I)0300       J:=(J мод (MAXOUT-1)500140   MIDDLE:=MAXOUT диж 20150   дим FOLD$ оф 10160   FOLD$:=цхр$(36)0170   дим INBUF$ оф 150, OUTBUF$ оф 1500180   вхиле GETLINE(INBUF$,5,150)=труе до0190     OUTBUF$:=спц$(150)0200     F:=INDEX(INBUF$,FOLD$)0210     J:=MIDDLE-10220     фор д9551   импорт XOPEN,PUTSTR,ERROR9552   FD:=XOPEN(NAME$,MODE)9553   иф FD=0 тхен9554     PUTSTR(NAME$,7)9555     ERROR(": CAN'T OPEN FILE")9556   ендиф 9557   ретурн FD9558 ендфунц MUSTOPEN9559 //9560 //FCOPY-COPY FILE FIN TO FILE FOUT9561 //0010 PROG$:="транслит"0020 //0030 //TRANSLIT-MAP CHARACTERS0040 //0050 INIT //INITIALISE0060 TRANSLIT0070 FINIT //FINALISE0080 енд 0090 //0100 //TRANSLIT-MAP CHARACTERS0110 //0120 проц TRANSLIT 0130   дим ARG$ оф 150, FROMSET$ оф 150, TOSET$ FROMSET$,150)=фалсе тхен ERROR("FROMSET TOO LARGE")0210   иф GETARG(2,ARG$,150)=фалсе тхен0220     TOSET$:=""0""0230   елиф MAKESET(ARG$,1,TOSET$,150)=фалсе тхен0240     ERROR("TOSET TOO LARGE")0250   елиф LENGTH(FROMSET$)<LENGTH(TOSET$) тхен0260  ASH=труе анд I>=LASTTO анд LASTTO>0 тхен0340       PUTC(TOSET$(LASTTO))0350       репеат 0360         I:=XINDEX(FROMSET$,GETC$(C$),ALLBUT,LASTTO)0370       унтил I<LASTTO0380     ендиф 0390     иф C$<>цхр$(92) тхен0400       иф I>0 анд LASTTO>0 тх FROM INDEX0510 //0520 фунц XINDEX(INSET$,C$,ALLBUT,LASTTO) цлосед0530   импорт INDEX0540   иф C$=цхр$(92) тхен0550     ретурн 00560   елиф ALLBUT=фалсе тхен0570     ретурн INDEX(INSET$,C$)0580   елиф INDEX(INSET$,C$)>0 тхен0590     ретурн 0060K,OUTSET$,J,MAXSET)0710   ретурн ADDSTR(""0"",OUTSET$,J,MAXSET)0720 ендфунц MAKESET0730 //0740 //DODASH-EXPAND SET AT SRC(I) INTO DEST(J), STOP AT DELIM0750 //0760 проц DODASH(DELIM$,SRC$,реф I,реф DEST$,реф J,MAXSET) цлосед0770   импорт ADDSTR,MEр SRC$(I+1)=""0"" тхен0840       JUNK:=ADDSTR("-",DEST$,J,MAXSET)0850     елиф (ISALPHANUM(SRC$(I-1)) анд ISALPHANUM(SRC$(I+1))) тхен0860       иф SRC$(I-1)<=SRC$(I+1) тхен0870         фор K:=орд(SRC$(I-1))+1 то орд(SRC$(I+1)) до0880           JUNK:0010 PROG$:="унияуе"0020 //0030 //UNIQUE-REMOVE ADJACENT DUPLICATE LINES0040 //0050 INIT //INITIALISE0060 UNIQUE0070 FINIT //FINALISE0080 енд 0090 //0100 //UNIQUE-REMOVE ADJACENT DUPLICATE LINES0110 //0120 проц UNIQUE 0130   дим BUF$(0:1) оф  /	0010 PROG$:="унротате"0020 //0030 //UNROTATE-UNROTATE LINES ROTATED BY KWIC0040 //0050 INIT //INITIALISE0060 UNROTATE0070 FINIT //FINALISE0080 енд 0090 //0100 //UNROTATE-UNROTATE LINES ROTATED BY KWIC0110 //0120 проц UNROTATE 0130   MAXOUT:=1 ё9562 проц FCOPY(FIN,FOUT) цлосед9563   импорт GETCF$,PUTCF9564   дим C$ оф 19565   вхиле GETCF$(C$,FIN)<>цхр$(92) до PUTCF(C$,FOUT)9566 ендпроц FCOPY9567 //	
цлосед9332   импорт LENGTH9333   ретурн XST$(1:LENGTH(XST$))9334 ендфунц STRNAME$9335 //9336 //XCREATE-CREATE A FILE9337 //9338 фунц XCREATE(NAME$,MODE) цлосед9339   импорт FDALLOC,XCLOSE,STRNAME$,CMDFIL(),FIL1,FIL2,FIL3,FIL49340   импорт FILE1$	369 ендфунц XCREATE9370 //9371 //XOPEN-OPEN A FILE9372 //9373 фунц XOPEN(NAME$,MODE) цлосед9374   импорт FDALLOC,XCLOSE,STRNAME$,CMDFIL(),FIL1,FIL2,FIL3,FIL49375   импорт FILE1$,FILE2$,FILE3$,FILE4$9376   FD:=FDALLOC9377   иф FD=0 тхен ретурн 09	FILE3$:=STRNAME$(NAME$)9388       опен филе FIL3,FILE3$,реад9389     вхен FIL49390       FILE4$:=STRNAME$(NAME$)9391       опен филе FIL4,FILE4$,реад9392     ендцасе 9393   хандлер 9394     иф ерр<>0 тхен9395       FD:=09396       принт ерр;еррф	цасе CMDFIL(FD) оф9408   вхен FIL19409     FILE1$:=""9410     цлосе филе FIL19411   вхен FIL29412     FILE2$:=""9413     цлосе филе FIL29414   вхен FIL39415     FILE3$:=""9416     цлосе филе FIL39417   вхен FIL49418     FILE4$:=""9419     цло	CMDFIL(),CMDOPEN()9430   цасе CMDFIL(FD) оф9431   вхен FIL19432     цлосе филе FIL19433     пасс "S0:"+FILE1$9434     FILE1$:=""9435   вхен FIL29436     цлосе филе FIL29437     пасс "S0:"+FILE2$9438     FILE2$:=""9439   вхен FIL39440     цлосе	GETCF-GET CHARACTER FROM FILE9453 //9454 фунц GETCF$(реф C$,FD) цлосед9455   импорт GETC'LASTC(),GETC'BUF$(),STDINP$,FILE1$,FILE2$,FILE3$,FILE4$9456   GETC'LASTC(FD):+19457   иф GETC'LASTC(FD)>150 тхен9458     иф еоф(FD) тхен9459       C$:=цхр$(92	 принт 9467     иф FILE4$="KB:" анд FD=4 тхен принт 9468     GETC'BUF$(FD):+""13""+спц$(150)9469     GETC'LASTC(FD):=19470   ендиф 9471   C$:=GETC'BUF$(FD)(GETC'LASTC(FD))9472   иф C$=""13"" тхен GETC'LASTC(FD):=1509473   ретурн C$9474 ендфунц GE	    елсе 9484       принт филе FD: PUTC'BUF$(FD)9485     ендиф 9486     PUTC'BUF$(FD):=""9487     PUTC'LASTC(FD):=09488   ендиф 9489   иф C$<>""13"" анд C$<>цхр$(92) тхен9490     PUTC'LASTC(FD):+19491     PUTC'BUF$(FD):+C$9492   ендиф 9493 ендп	ET LINE FROM FILE9507 //9508 фунц GETLINE(реф ST$,FD,SIZE) цлосед9509   импорт GETCF$,MESSAGE9510   дим CH$ оф 19511   ST$:=""9512   I:=09513   репеат 9514     DONE:=труе9515     CH$:=GETCF$(CH$,FD)9516     иф CH$=цхр$(92) тхен9517       I:=0   ендиф 9530   унтил DONE=труе9531   ST$:+""0""9532   иф I=0 тхен ретурн фалсе9533   ретурн труе9534 ендфунц GETLINE9535 //9536 //MUSTCREATE-CREATE A FILE OR DIE9537 //9538 фунц MUSTCREATE(NAME$,MODE) цлосед9539   импорт XCREATE,PUTSTR,ERROR95	,FILE2$,FILE3$,FILE4$9341   FD:=FDALLOC9342   иф FD=0 тхен ретурн 09343   трап 9344     цасе CMDFIL(FD) оф9345     вхен FIL19346       FILE1$:=STRNAME$(NAME$)9347       пасс "S0:"+FILE1$9348       опен филе FIL1,FILE1$,врите9349     вхен FIL293	ILE4$:=STRNAME$(NAME$)9359       пасс "S0:"+FILE4$9360       опен филе FIL4,FILE4$,врите9361     ендцасе 9362   хандлер 9363     иф ерр<>0 тхен9364       FD:=09365       принт ерр;еррфиле;ерртеьт$9366     ендиф 9367   ендтрап 9368   ретурн FD9	378   трап 9379     цасе CMDFIL(FD) оф9380     вхен FIL19381       FILE1$:=STRNAME$(NAME$)9382       опен филе FIL1,FILE1$,реад9383     вхен FIL29384       FILE2$:=STRNAME$(NAME$)9385       опен филе FIL2,FILE2$,реад9386     вхен FIL39387       	иле;ерртеьт$9397     ендиф 9398   ендтрап 9399   ретурн FD9400 ендфунц XOPEN9401 //9402 //XCLOSE-CLOSE A FILE9403 //9404 проц XCLOSE(FD) цлосед9405   импорт FIL1,FIL2,FIL3,FIL4,FILE1$,FILE2$,FILE3$,FILE4$9406   импорт CMDOPEN(),CMDFIL()9407   	се филе FIL49420   ендцасе 9421   CMDOPEN(CMDFIL(FD)):=фалсе9422   CMDFIL(FD):=09423 ендпроц XCLOSE9424 //9425 //XREMOVE-REMOVE A FILE9426 //9427 проц XREMOVE(FD) цлосед9428   импорт FIL1,FIL2,FIL3,FIL4,FILE1$,FILE2$,FILE3$,FILE4$9429   импорт 	 филе FIL39441     пасс "S0:"+FILE3$9442     FILE3$:=""9443   вхен FIL49444     цлосе филе FIL49445     пасс "S0:"+FILE4$9446     FILE4$:=""9447   ендцасе 9448   CMDOPEN(CMDFIL(FD)):=фалсе9449   CMDFIL(FD):=09450 ендпроц XREMOVE9451 //9452 //	)9460       ретурн C$9461     ендиф 9462     инпут филе FD: GETC'BUF$(FD)9463     иф STDINP$="KB:" анд FD=5 тхен принт 9464     иф FILE1$="KB:" анд FD=1 тхен принт 9465     иф FILE2$="KB:" анд FD=2 тхен принт 9466     иф FILE3$="KB:" анд FD=3 тхен	TCF$9475 //9476 //PUTCF-PUT CHARACTER ON FILE9477 //9478 проц PUTCF(C$,FD) цлосед9479   импорт PUTC'LASTC(),PUTC'BUF$()9480   иф PUTC'LASTC(FD)>=148 ор C$=""13"" ор C$=цхр$(92) тхен9481     иф FD=7 тхен9482       принт филе 6: PUTC'BUF$(FD)9483 	роц PUTCF9494 //9495 //PUTSTR-PUT STRING ON FILE9496 //9497 проц PUTSTR(ST$,FD) цлосед9498   импорт PUTCF9499   I:=19500   вхиле ST$(I)<>""0"" до9501     PUTCF(ST$(I),FD)9502     I:+19503   ендвхиле 9504 ендпроц PUTSTR9505 //9506 //GETLINE-G		9518     елиф CH$=""13"" тхен9519       I:+19520       ST$:+""13""9521     елиф SIZE-2<=I тхен9522       MESSAGE("LINE TOO LONG")9523       I:+19524       ST$:+""13""9525     елсе 9526       DONE:=фалсе9527       I:+19528       ST$:+CH$9529   	50       FILE2$:=STRNAME$(NAME$)9351       пасс "S0:"+FILE2$9352       опен филе FIL2,FILE2$,врите9353     вхен FIL39354       FILE3$:=STRNAME$(NAME$)9355       пасс "S0:"+FILE3$9356       опен филе FIL3,FILE3$,врите9357     вхен FIL49358       F

 до PUTC(CHARS$(I:I))9103 ендпроц PUTDEC9104 //9105 //MIN-COMPUTE MINIMUM9106 //9107 фунц MIN(X,Y) цлосед9108   иф X<Y тхен9109     ретурн X9110   елсе 9111     ретурн Y9112   ендиф 9113 ендфунц MIN9114 //9115 //MAX-COMPUTE MAXIMUM9116 //9
ндфунц ISDIGIT9148 //9149 //ISLETTER-TRUE IF C$ IS A LETTER9150 //9151 фунц ISLETTER(C$) цлосед9152   импорт ISUPPER,ISLOWER9153   иф ISUPPER(C$)=труе тхен ретурн труе9154   иф ISLOWER(C$)=труе тхен ретурн труе9155   ретурн фалсе9156 ендфунц ISL
HANUM9166 //9167 //INDEX-FINDCHAR C IN ST9168 //9169 фунц INDEX(ST$,C$) цлосед9170   иф C$="" тхен ретурн 09171   ретурн C$ ин ST$9172 ендфунц INDEX9173 //9174 //LENGTH-GET STRING LENGTH9175 //9176 фунц LENGTH(ST$) цлосед9177   L:=09178   вх
188     OUTSET$(J):=C$9189     J:+19190     ретурн труе9191   ендиф 9192 ендфунц ADDSTR9193 //9194 //META-MAP S(I) INTO ESCAPED CHAR9195 //9196 фунц META$(S$,реф I) цлосед9197   иф S$(I)<>цхр$(64) тхен9198     ретурн S$(I)9199   елиф S$(I+1)="
9211 ендфунц META$9212 //9213 //CTOI-CONVERT STRING AT ST$(I),INCREMENT I9214 //9215 фунц CTOI(ST$,реф I) цлосед9216   импорт INDEX,ISDIGIT9217   дим DIGITS$ оф 119218   DIGITS$:="0123456789"+""0""9219   вхиле ST$(I)=" " до I:+19220   иф ST$(I)
ндфунц CTOI9233 //9234 //NARGS-RETURN NUMBER OF ARGUMENTS9235 //9236 фунц NARGS цлосед9237   импорт CMDARGS9238   ретурн CMDARGS9239 ендфунц NARGS9240 //GETARG-GET N'TH ARGUMENT INTO S$9241 //9242 фунц GETARG(N,реф S$,MAXSIZE) цлосед9243   имп
$,J) цлосед9253   вхиле SRC$(I)<>""0"" до9254     DEST$(J):=SRC$(I)9255     I:+19256     J:+19257   ендвхиле 9258   DEST$(J):=""0""9259 ендпроц SCOPY9260 //9261 //ERROR-PRINT FATAL ERROR9262 //9263 проц ERROR(MSG$) цлосед9264   импорт PUTSTR
O STRINGS FOR EQUALITY9278 //9279 фунц EQUAL(STR1$,STR2$) цлосед9280   I:=19281   вхиле STR1$(I)=STR2$(I) анд STR1$(I)<>""0"" до I:+19282   иф STR1$(I)=STR2$(I) тхен ретурн труе9283   ретурн фалсе9284 ендфунц EQUAL9285 //9286 //FTALLOC-ALLOCATE 
PEN(FT)=труе тхен9297     ретурн 09298   елсе 9299     ретурн FT9300   ендиф 9301 ендфунц FTALLOC9302 //9303 //FDALLOC-ALLOCATE A FILE DESCRIPTOR9304 //9305 фунц FDALLOC цлосед9306   импорт CMDFIL(),CMDOPEN(),FTALLOC,FIL19307   FD:=FIL19308  	 9320     иф CMDFIL(FD)=0 тхен9321       ретурн 09322     елсе 9323       CMDOPEN(CMDFIL(FD)):=труе9324       ретурн FD9325     ендиф 9326   ендиф 9327 ендфунц FDALLOC9328 //9329 //STRNAME-MAP TO NATIVE FILE NAME9330 //9331 фунц STRNAME$(XST$) 
117 фунц MAX(X,Y) цлосед9118   иф X>Y тхен9119     ретурн X9120   елсе 9121     ретурн Y9122   ендиф 9123 ендфунц MAX9124 //9125 //ISUPPER-TRUE IF C$ UPPER-CASE9126 //9127 фунц ISUPPER(C$) цлосед9128   иф C$="" тхен ретурн фалсе9129   иф (C$ 
)>0 тхен ретурн труе9138   ретурн фалсе9139 ендфунц ISLOWER9140 //9141 //ISDIGIT-TRUE IF C$ IS A DIGIT9142 //9143 фунц ISDIGIT(C$) цлосед9144   иф C$="" тхен ретурн фалсе9145   иф (C$ ин "0123456789")>0 тхен ретурн труе9146   ретурн фалсе9147 е
ETTER9157 //9158 //ISALPHANUM-TRUE IF C$ ALPHANUMERIC9159 //9160 фунц ISALPHANUM(C$) цлосед9161   импорт ISLETTER,ISDIGIT9162   иф ISLETTER(C$)=труе тхен ретурн труе9163   иф ISDIGIT(C$)=труе тхен ретурн труе9164   ретурн фалсе9165 ендфунц ISALP
иле ST$(L+1)<>цхр$(0) до L:+19179   ретурн L9180 ендфунц LENGTH9181 //9182 //ADDSTR-PUT C$ IN OUTSET$(J) IF IT FITS, INCREMENT J9183 //9184 фунц ADDSTR(C$,реф OUTSET$,реф J,MAXSIZ) цлосед9185   иф J>MAXSIZ тхен9186     ретурн фалсе9187   елсе 9
"0"" тхен //NOT SPECIAL AT END9200     ретурн цхр$(64)9201   елсе 9202     I:+19203     иф S$(I)="N" тхен9204       ретурн ""13""9205     елиф S$(I)="S" тхен9206       ретурн " "9207     елсе 9208       ретурн S$(I)9209     ендиф 9210   ендиф 
="-" тхен9221     SIGN:=-19222   елсе 9223     SIGN:=19224   ендиф 9225   иф (ST$(I) ин "+-") тхен I:+19226   N:=09227   вхиле ISDIGIT(ST$(I))=труе до9228     N:=10*N+орд(ST$(I))-орд("0")9229     I:+19230   ендвхиле 9231   ретурн SIGN*N9232 е
орт CMDARGS,CMDLIN$,CMDIDX(),SCOPY9244   иф N<1 ор CMDARGS<N тхен ретурн фалсе9245   S$:=спц$(150)9246   SCOPY(CMDLIN$,CMDIDX(N),S$,1)9247   ретурн труе9248 ендфунц GETARG9249 //9250 //SCOPY-COPY SRC TO DEST9251 //9252 проц SCOPY(SRC$,I,реф DEST
9265   PUTSTR(MSG$+""13""0"",7)9266   цлосе9267   енд 9268 ендпроц ERROR9269 //9270 //MESSAGE-PRINT MESSAGE9271 //9272 проц MESSAGE(MSG$) цлосед9273   импорт PUTSTR9274   PUTSTR(MSG$+""13""0"",7)9275 ендпроц MESSAGE9276 //9277 //EQUAL-TEST TW
A FILE9287 //9288 фунц FTALLOC цлосед9289   импорт FIL1,FIL4,CMDOPEN()9290   FT:=FIL19291   репеат 9292     DONE:=фалсе9293     иф CMDOPEN(FT)=фалсе ор FT=FIL4 тхен DONE:=труе9294     иф DONE=фалсе тхен FT:+19295   унтил DONE=труе9296   иф CMDO
	 DONE:=фалсе9309   вхиле DONE=фалсе до9310     иф CMDFIL(FD)=0 ор FD=4 тхен9311       DONE:=труе9312     елсе 9313       FD:+19314     ендиф 9315   ендвхиле 9316   иф CMDFIL(FD)<>0 тхен9317     ретурн 09318   елсе 9319     CMDFIL(FD):=FTALLOC
ин "абцдефгхийклмнопярстужвьыз")>0 тхен ретурн труе9130   ретурн фалсе9131 ендфунц ISUPPER9132 //9133 //ISLOWER-TRUE IF C$ LOWER-CASE9134 //9135 фунц ISLOWER(C$) цлосед9136   иф C$="" тхен ретурн фалсе9137   иф (C$ ин "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
0         ендвхиле 3690       ендиф 3700       I:-13710       J:-13720     ендвхиле 3730   ендиф 3740 ендпроц SPREAD3750 //3760 //UNDERLN-UNDERLINE A LINE3770 //3780 проц UNDERLN(реф BUF$,SIZE) цлосед3790   нулл //THIS IS A DUMMY3800 ендпроц 90   иф INBUF$(1:1)=" " ор INBUF$(1:1)=цхр$(13) тхен4100     LEADBL(INBUF$) //MOVE LEFT,SET TIVAL4110   ендиф 4120   иф ULVAL>0 тхен //UNDERLINING4130     UNDERLN(INBUF$,150)4140     ULVAL:-14150   ендиф 4160   иф CEVAL>0 тхен //CENTERING4170    0       I:=GETWORD(INBUF$,I,WORDBUF$)4280       иф I>0 тхен PUTWORD(WORDBUF$)4290     унтил I=04300   ендиф 4310 ендпроц TEXT4320 //4330 //GETWORD-GET WORD FROM S$(I) INTO OUT$4340 фунц GETWORD(S$,I,реф OUT$) цлосед4350   дим C$ оф 14360   вхиле 9н ретурн 04460   ретурн I4470 ендфунц GETWORD4480 //1:=1; FIL2:=2; FIL3:=3; FIL4:=49007   паге9008   принт "сOFTWARE тOOLS сYSTEM (цOMAL) жERSION 1"9009   принт ""13"",PROG$,""13""9010   STDINP$:="KB:"9011   STDOUT$:="DS:"9012   дим GETC'LASTC(5), PUTC'LASTC(7)9013   фор I:=1 то 5 до GETC'LASTC(I):N(I):=фалсе9020   CMDLIN$:=спц$(150)9021   фор IDX:=1 то 40 до CMDIDX(IDX):=09022   инпут "$": CMDLIN$9023   CMDLIN$:+""13""0""9024   CMDARGS:=09025   IDX:=19026   вхиле CMDLIN$(IDX)<>""0"" анд тхен CMDLIN$(IDX)<>""13"" до9027     вхиле CMDLIN$(I$(CMDIDX(CMDARGS))="<" тхен9035         CMDIDX(CMDARGS):+19036         JUNK:=GETARG(CMDARGS,STDINP$,40)9037         STDINP$:=STDINP$(1:LENGTH(STDINP$))9038         CMDARGS:-19039       елиф CMDLIN$(CMDIDX(CMDARGS))=">" тхен9040         CMDIDX(CMDAR филе 6,STDOUT$,врите9050   елиф "CS:" ин STDOUT$ тхен9051     опен филе 6,STDOUT$,врите9052   елиф "LP:" ин STDOUT$ тхен9053     опен филе 6,STDOUT$,врите9054   елсе 9055     пасс "S0:"+STDOUT$9056     опен филе 6,STDOUT$,врите9057   ендиф 9058$(92),I)9069     цлосе филе I9070   ендфор I9071   инпут "рELOAD мену (ы/цр) ? ": ANS$9072   иф ANS$="Y" тхен цхаин "MENU"9073 ендпроц FINIT9074 //9075 //9076 //GETC-GET CHARACTERS FROM STANDARD INPUT9077 //9078 фунц GETC$(реф C$) цлосед9079  
 GER N IN FIELD WIDTH >= W9092 //9093 проц PUTDEC(N,W) цлосед9094   импорт PUTC9095   дим CHARS$ оф 209096   CHARS$:=стр$(N)9097   I:=лен(CHARS$)+19098   вхиле I<=W до9099     PUTC(" ")9100     I:+19101   ендвхиле 9102   фор I:=1 то лен(CHARS$)UNDERLN3810 //3820 //CENTRE-CENTRE ALINE BY SETTING TIVAL3830 //3840 проц CENTRE(BUF$) цлосед3850   импорт MAX,WIDTH3860   импорт TIVAL,RMVAL3870   TIVAL:=MAX((RMVAL+TIVAL-WIDTH(BUF$)) диж 2,0)3871   //принт "TIVAL=",TIVAL3880 ендпроц CENTRE389TC(цхр$(13))4010 ендпроц SKIP4020 //4030 //TEXT-PROCESS TEXT LINES4040 //4050 проц TEXT(реф INBUF$) цлосед4060   импорт LEADBL,UNDERLN,CENTRE,PUT,GETWORD,PUTWORD4070   импорт ULVAL,CEVAL,FILL4080   дим WORBUF$ оф 1504081   WORDBUF$:=спц$(150)40 CENTRE(INBUF$)4180     PUT(INBUF$)4190     CEVAL:-14200   елиф INBUF$(1)=цхр$(13) тхен //ALL-BLANK LINE4210     PUT(INBUF$)4220   елиф FILL=фалсе тхен //UNFILLED TEXT4230     PUT(INBUF$)4240   елсе //FILLED TEXT4250     I:=14260     репеат 427 S$(I:I)=" " ор S$(I:I)=цхр$(13) до I:+14370   OUT$:=""4380   C$:=S$(I:I)4390   вхиле нот (C$=цхр$(0) ор C$=" " ор C$=цхр$(13)) до4400     OUT$:+C$4410     I:+14420     C$:=S$(I:I)4430   ендвхиле 4440   OUT$:+цхр$(0)4450   иф S$(I:I)=цхр$(0) тхе9000 //9001 //INIT-SET UP SYSTEM GLOBALS AND REDIRECT FILES9002 //9003 проц INIT 9004   дим STDINP$ оф 40, STDOUT$ оф 40, CMDLIN$ оф 150, CMDIDX(40)9005   дим CMDFIL(4), CMDOPEN(0:4), FILE1$ оф 40, FILE2$ оф 40, FILE3$ оф 40, FILE4$ оф 409006   FIL=1509014   фор I:=1 то 7 до PUTC'LASTC(I):=09015   дим GETC'BUF$(5) оф 150, PUTC'BUF$(7) оф 1489016   фор I:=1 то 5 до GETC'BUF$(I):=спц$(150)9017   фор I:=1 то 7 до PUTC'BUF$(I):=""9018   фор I:=1 то 4 до CMDFIL(I):=09019   фор I:=0 то 4 до CMDOPEDX)=" " до IDX:+19028     иф CMDLIN$(IDX)<>""13"" тхен9029       CMDARGS:+19030       CMDIDX(CMDARGS):=IDX9031       вхиле CMDLIN$(IDX)<>""13"" анд тхен CMDLIN$(IDX)<>" " до IDX:+19032       CMDLIN$(IDX):=""0""9033       IDX:+19034       иф CMDLINGS):+19041         JUNK:=GETARG(CMDARGS,STDOUT$,40)9042         STDOUT$:=STDOUT$(1:LENGTH(STDOUT$))9043         CMDARGS:-19044       ендиф 9045     ендиф 9046   ендвхиле 9047   опен филе 5,STDINP$,реад9048   иф "DS:" ин STDOUT$ тхен9049     опен ендпроц INIT9059 //9060 //FINIT-DO ALL FINALISATIONS9061 //9062 проц FINIT 9063   дим ANS$ оф 19064   иф PUTC'LASTC(6)>0 тхен PUTC(цхр$(92))9065   цлосе филе 59066   цлосе филе 69067   фор I:=1 то 4 до9068     иф PUTC'LASTC(I)>0 тхен PUTCF(цхр	 импорт GETCF$9080   ретурн GETCF$(C$,5)9081 ендфунц GETC$9082 //9083 //9084 //PUTC-PUT CHARACTERS ONTO STANDARD OUTPUT9085 //9086 проц PUTC(C$) цлосед9087   импорт PUTCF9088   PUTCF(C$,6)9089 ендпроц PUTC9090 //9091 //PUTDEC-PUT DECIMAL INTE0 //3900 //SKIPBL-SKIP BLANKS AT S$(I)3910 //3920 проц SKIPBL(S$,реф I) цлосед3930   вхиле S$(I:I)=" " до I:+13940 ендпроц SKIPBL3950 //3960 //SKIP-OUTPUT N BLANK LINES3970 //3980 проц SKIP(N) цлосед3990   импорт PUTC4000   фор I:=1 то N до PU
т MIN,MAX1770   цасе ARGTYPE$ оф1780   вхен цхр$(13) //DEFAULTED1790     PARAM:=DEFVAL1800   вхен "+" //RELATIVE +1810     PARAM:+VL1820   вхен "-" //RELATIVE -1830     PARAM:-VL1840   отхервисе //ABSOLUTE1850     PARAM:=VL1860   ендцасе 1870 20     SKIP(M1VAL-1)2130     PUTTL(HEADER$,CURPAGE)2140   ендиф 2150   SKIP(M2VAL)2160   LINENO:=M1VAL+M2VAL+12170 ендпроц PUTHEAD2180 //2190 //PUTFOOT-PUT OUT PAGE FOOTER2200 //2210 проц PUTFOOT цлосед2220   импорт SKIP,PUTTL2230   импорт M3V$,PAGENO) цлосед2340   импорт LENGTH,PUTDEC,PUTC2350   фор I:=1 то LENGTH(BUF$) до2360     иф BUF$(I:I)="#" тхен2370       PUTDEC(PAGENO,1)2380     елсе 2390       PUTC(BUF$(I:I))2400     ендиф 2410   ендфор I2420 ендпроц PUTTL2430 //2440 //GEUF$(I:I)="'" ор BUF$(I:I)="""" тхен I:+1 //STRIP LEADING QUOTE2520   SCOPY(BUF$,I,TTL$,1)2530 ендпроц GETTL2540 //2550 //SPACE-SPACE N LINES OR TO BOTTOM OF PAGE2560 //2570 проц SPACE(N) цлосед2580   импорт BREAK,PUTHEAD,SKIP,MIN,PUTFOOT2590   им NEW PAGE2690 //2700 проц NEWPAGE цлосед2710   импорт BREAK,SKIP,PUTFOOT2720   импорт LINENO,BOTTOM2730   BREAK2740   иф LINENO>0 анд LINENO<=BOTTOM тхен2750     SKIP(BOTTOM+1-LINENO)2760     PUTFOOT2770   ендиф 2780   LINENO:=02790 ендпроц NEр$(13) тхен TIVAL:=TIVAL+I-12900   фор J:=I то LENGTH(BUF$) до BUF$(J-I+1:J-I+1):=BUF$(J:J) //MOVE LEFT2910 ендпроц LEADBL2920 //2930 //WIDTH-COMPUTE WIDTH OF CHARACTER STRING2940 //2950 фунц WIDTH(реф BUF$) цлосед2960   W:=02970   I:=12980   вхTWDS,OUTBUF$3100   иф OUTP>0 тхен3110     OUTBUF$(OUTP:OUTP):=цхр$(13)3120     OUTBUF$(OUTP+1:OUTP+1):=цхр$(0)3130     PUT(OUTBUF$)3140   ендиф 3150   OUTP:=03160   OUTW:=03170   OUTWDS:=03180 ендпроц BREAK3190 //3200 //PUTWORD-PUT WORD IN OUT OF OUTBUF$3270   LLVAL:=RMVAL-TIVAL-INVAL3280   иф OUTP>0 анд (OUTW+W>LLVAL ор LAST>=150) тхен3290     LAST:-OUTP //REMEMBER END OF WORDBUF$3300     NEXTRA:=LLVAL-OUTW+13310     иф NEXTRA>0 анд OUTWDS>1 тхен3320       SPREAD(OUTBUF$,OUTP,NEXTRA,OUWDS:+13420 ендпроц PUTWORD3430 //3440 //SPREAD-SPREAD WORDS TO JUSTIFY RIGHT MARGIN3450 //3460 проц SPREAD(реф BUF$,OUTP,NEXTRA,OUTWDS) цлосед3470   импорт MIN3480   импорт DIRT3490   иф NEXTRA>0 анд OUTWDS>1 тхен3500     DIRT:=1-DIRT //REVERSE    NB:=(NEXTRA-1) диж NHOLES+13590         елсе 3600           NB:=NEXTRA диж NHOLES3610         ендиф 3620         NEXTRA:-NB3630         NHOLES:-13640         вхиле NB>0 до3650           J:-13660           BUF$(J:J):=" "3670           NB:-1368  PARAM:=MIN(PARAM,MAXVAL)1880   PARAM:=MAX(PARAM,MINVAL)1890 ендпроц SETPARAM1900 //1910 //PUT-PUT OUT LINE WITH PROPER SPACING AND INDENTATION1920 //1930 проц PUT(реф BUF$) цлосед1940   импорт PUTHEAD,PUTC,PUTSTR,SKIP,MIN,PUTFOOT1950   импорт LOTTOM тхен PUTFOOT2020 ендпроц PUT2030 //2040 //PUTHEAD-PUT OUT PAGE HEADER2050 //2060 проц PUTHEAD цлосед2070   импорт SKIP,PUTTL2080   импорт CURPAGE,NXTPAGE,M1VAL,M2VAL,HEADER$2090   CURPAGE:=NXTPAGE2100   NXTPAGE:+12110   иф M1VAL>0 тхен21AL,M4VAL,CURPAGE,FOOTER$2240   SKIP(M3VAL)2250   иф M4VAL>0 тхен2260     PUTTL(FOOTER$,CURPAGE)2270     SKIP(M4VAL-1)2280   ендиф 2290 ендпроц PUTFOOT2300 //2310 //PUTTL-PUT OUT TITLE LINE WITH OPTIONAL PAGE NUMBER2320 //2330 проц PUTTL(реф BUFTTL-COPY TITLE FROM BUF$ TO TTL$2450 //2460 проц GETTL(реф BUF$,реф TTL$) цлосед2470   импорт SKIPBL,SCOPY2480   I:=1 //SKIP COMMAND NAME2490   вхиле нот (BUF$(I:I)=" " ор BUF$(I:I)=цхр$(13)) до I:+12500   SKIPBL(BUF$,I) //FIND ARGUMENT2510   иф Bпорт LINENO,BOTTOM2600   BREAK2610   иф LINENO<=BOTTOM тхен2620     иф LINENO<=0 тхен PUTHEAD2630     SKIP(MIN(N,BOTTOM+1-LINENO))2640     LINENO:+N2650     иф LINENO>BOTTOM тхен PUTFOOT2660   ендиф 2670 ендпроц SPACE2680 //NEWPAGE-GET TO TOP OFWPAGE2800 //2810 //LEADBL-DELETE LEADING BLANKS, SET TIVAL2820 //2830 проц LEADBL(реф BUF$) цлосед2840   импорт BREAK,LENGTH2850   импорт TIVAL2860   BREAK2870   I:=12880   вхиле BUF$(I:I)=" " до I:+1 //FIND 1ST NON-BLANK2890   иф BUF$(I:I)<>цхиле BUF$(I:I)<>цхр$(0) до2990     иф BUF$(I:I)<>цхр$(13) тхен W:+13000     I:+13010   ендвхиле 3020   ретурн W3030 ендфунц WIDTH3040 //3050 //BREAK-END CURRENT FILLED LINE3060 //3070 проц BREAK цлосед3080   импорт PUT3090   импорт OUTP,OUTW,OUBUF$; DOES MARGIN JUSTIFICATION3210 //3220 проц PUTWORD(реф WORDBUF$) цлосед3230   импорт WIDTH,LENGTH,SPREAD,BREAK,SCOPY3240   импорт OUTP,RMVAL,TIVAL,INVAL,OUTW,OUTWDS,OUTBUF$3250   W:=WIDTH(WORDBUF$)3260   LAST:=LENGTH(WORDBUF$)+OUTP+1 //NEW ENDTWDS)3330       OUTP:+NEXTRA3340     ендиф 3350     BREAK //FLUSH PREVIOUS LINE3360   ендиф 3370   SCOPY(WORDBUF$,1,OUTBUF$,OUTP+1)3380   OUTP:=LAST3390   OUTBUF$(OUTP:OUTP):=" " //SPACE BETWEEN WORDS3400   OUTW:=OUTW+W+1 //1 FOR BLANK3410   OUT	PREVIOUS DIRECTION3510     NHOLES:=OUTWDS-13520     I:=OUTP-13530     J:=MIN(150-2,I+NEXTRA) //ROOM FOR NEWLINE AND ENDSTR3540     вхиле I<J до3550       BUF$(J:J):=BUF$(I:I)3560       иф BUF$(I:I)=" " тхен3570         иф DIRT=0 тхен3580         INENO,BOTTOM,INVAL,TIVAL,LSVAL1960   иф LINENO<=0 ор LINENO>BOTTOM тхен PUTHEAD1970   фор I:=1 то INVAL+TIVAL до PUTC(" ") //INDENTING1971   TIVAL:=01980   PUTSTR(BUF$,6)1990   SKIP(MIN(LSVAL-1,BOTTOM-LINENO))2000   LINENO:+LSVAL2010   иф LINENO>B
200 проц SCCOPY(S$,реф CB$,I) цлосед3210   J:=13220   вхиле S$(J)<>""0"" до3230     CB$(I):=S$(J)3240     J:+13250     I:+13260   ендвхиле 3270   CB$(I):=""0""3280 ендпроц SCCOPY3290 //3300 //CSCOPY-COPY CB(I)... TO STRING S3310 //3320 проц C FO:=50180   HE:=60190   IND:=70200   LS:=80210   NF:=90220   PL:=100230   RM:=110240   SP:=120250   TI:=130260   UL:=140270   PA:=150280   NL:=160290   UNKNOWN:=00300   CURPAGE:=0 //CURRENT PAGENO0310   NXTPAGE:=1 //NEXT PAGENO0320   LINE4VAL //LAST TEXT LINE0390   дим HEADER$ оф 150, FOOTER$ оф 1500400   HEADER$:=цхр$(13)+цхр$(0)0410   FOOTER$:=цхр$(13)+цхр$(0)0420   FILL:=труе //FILL IF TRUE0430   LSVAL:=1 //LINE SPACING0440   SPVAL:=0 //# OF LINES TO SPACE0450   INVAL:=0 //INDES IN OUTBUF$0530   дим OUTBUF$ оф 150 //OUTPUT NUFFER0540   DIRT:=0 //DIRECTION FOR PADDING0550   дим INBUF$ оф 1500551   OUTBUF$:=спц$(150)0560   вхиле GETLINE(INBUF$,5,150)=труе до0570     иф INBUF$(1:1)="." тхен0580       COMMAND(INBUF$)0590  LL,NF,BR,LS,LSVAL,CE,CEVAL,UL,ULVAL,HE,HEADER$0663   импорт FO,FOOTER$,CURPAGE,NXTPAGE,SPVAL,INVAL,RMVAL,TIVAL,PLVAL0664   импорт M1VAL,M2VAL,M3VAL,M4VAL,BOTTOM,PA,NL,BP,SP,IND,RM,TI,PL0669   //принт "COMMAND"0670   дим ARGTYPE$ оф 10680   CMD:=GETC0800     SETPARAM(LSVAL,VL,ARGTYPE$,1,1,1000)0810   вхен CE0820     BREAK0830     SETPARAM(CEVAL,VL,ARGTYPE$,1,0,1000)0840   вхен UL0850     SETPARAM(ULVAL,VL,ARGTYPE$,1,0,1000)0860   вхен HE0870     GETTL(BUF$,HEADER$)0880   вхен FO0890     GETVAL,VL,ARGTYPE$,0,0,RMVAL-1)0990   вхен RM1000     SETPARAM(RMVAL,VL,ARGTYPE$,80,INVAL+TIVAL+1,1000)1010   вхен TI1020     BREAK1030     SETPARAM(TIVAL,VL,ARGTYPE$,0,-1000,RMVAL)1040   вхен PL1050     SETPARAM(PLVAL,VL,ARGTYPE$,66,M1VAL+M2VAL+M3VAсе 1140     нулл1150   ендцасе 1160 ендпроц COMMAND1170 //1180 //GETCMD-DECODE COMMAND TYPE1190 //1200 фунц GETCMD(реф BUF$) цлосед1201   импорт FI,NF,BR,LS,BP,SP,IND,RM,TI,CE,UL,HE,FO,PL,PA,NL,UNKNOWN1209   //принт "GETCMD"1210   дим CMD$ оф 240   вхен "SP"1350     ретурн SP1360   вхен "IN"1370     ретурн IND1380   вхен "RM"1390     ретурн RM1400   вхен "TI"1410     ретурн TI1420   вхен "CE"1430     ретурн CE1440   вхен "UL"1450     ретурн UL1460   вхен "HE"1470     ретурн HE148ONAL NUMERIC ARGUMENT1620 //1630 фунц GETVAL(реф BUF$,реф ARGTYPE$) цлосед1640   импорт SKIPBL,CTOI1650   I:=1 //SKIP OVER COMMAND NAME1660   вхиле нот (BUF$(I:I)=" " ор BUF$(I:I)=цхр$(13)) до I:+11670   SKIPBL(BUF$,I) //FIND ARGUMENT1680   ARGTYP бSCOPY(CB$,I,реф S$) цлосед3330   S$:=""3340   J:=13350   вхиле CB$(I)<>""0"" до3360     S$:+CB$(I)3370     I:+13380     J:+13390   ендвхиле 3400   S$:+""0""3410 ендпроц CSCOPY3420 //0010 PROG$:="формат"0020 //0030 //FORMAT-TEXT FORMATTER0040 //0050 INIT //INITIALISE0060 FORMAT0070 FINIT //FINALISE0080 енд 0090 //0100 //FORMAT-TEXT FORMATTER0110 //0120 проц FORMAT 0130   BP:=10140   BR:=20150   CE:=30160   FI:=40170  NO:=0 //NEXT LINENO0330   PLVAL:=66 //PAGELEN0340   M1VAL:=3 //TOP MARGIN INCLUDING HEADER0350   M2VAL:=2 //MARGIN AFTER HEADER0360   M3VAL:=2 //MARGIN AFTER LAST TEXT LINE0370   M4VAL:=3 //BOTTOM MARGIN INCLUDING FOOTER0380   BOTTOM:=PLVAL-M3VAL-MNT0460   RMVAL:=80 //RIGHT MARGIN0470   TIVAL:=0 //TEMP INDENT0480   CEVAL:=0 //# OF LINES TO SPACE0490   ULVAL:=0 //# OF LINES TO UNDERLINE0500   OUTP:=0 //LAST CHAR POS IN OUTBUF$0510   OUTW:=0 //TEXT WIDTH IN OUTBUF$0520   OUTWDS:=0 //# OF WORD   елсе 0600       TEXT(INBUF$)0610     ендиф 0620   ендвхиле 0630   NEWPAGE //FLUSH LAST OUTPUT0640 ендпроц FORMAT0650 //0660 проц COMMAND(реф BUF$) цлосед0661   импорт GETCMD,GETVAL,BREAK,SETPARAM,GETTL,NEWPAGE,SPACE0662   импорт UNKNOWN,FI,FIMD(BUF$)0681   //принт "CMD=",CMD0690   иф CMD<>UNKNOWN тхен VL:=GETVAL(BUF$,ARGTYPE$)0700   цасе CMD оф0710   вхен FI0720     BREAK0730     FILL:=труе0740   вхен NF0750     BREAK0760     FILL:=фалсе0770   вхен BR0780     BREAK0790   вхен LSTL(BUF$,FOOTER$)0900   вхен BP0910     NEWPAGE0920     SETPARAM(CURPAGE,VL,ARGTYPE$,CURPAGE+1,-1000,1000)0930     NXTPAGE:=CURPAGE0940   вхен SP0950     SETPARAM(SPVAL,VL,ARGTYPE$,1,0,1000)0960     SPACE(SPVAL)0970   вхен IND0980     SETPARAM(INL+M4VAL+1,1000)1060     BOTTOM:=PLVAL-M3VAL-M4VAL1070   вхен PA1080     SETPARAM(SPVAL,VL,ARGTYPE$,1,0,1000)1090     SPACE(SPVAL)1100     SETPARAM(TIVAL,5,"+",0,-1000,RMVAL)1110   вхен NL1120     иф LINENO+VL>BOTTOM тхен SPACE(1000)1130   отхерви1220   CMD$:=BUF$(2:3)1221   //принт "CMD$=",CMD$1230   цасе CMD$ оф1240   вхен "FI"1250     ретурн FI1260   вхен "NF"1270     ретурн NF1280   вхен "BR"1290     ретурн BR1300   вхен "LS"1310     ретурн LS1320   вхен "BP"1330     ретурн BP13	0   вхен "FO"1490     ретурн FO1500   вхен "PL"1510     ретурн PL1520   вхен "PA"1530     ретурн PA1540   вхен "NL"1550     ретурн NL1560   отхервисе 1570     ретурн UNKNOWN1580   ендцасе 1590 ендфунц GETCMD1600 //1610 //GETVAL-EVALUATE OPTI E$:=BUF$(I:I)1690   иф ARGTYPE$="+" ор ARGTYPE$="-" тхен I:+11700   ретурн CTOI(BUF$,I)1710 ендфунц GETVAL1720 //1730 //SETPARAM-SET PARAMETER AND CHECK RANGE1740 //1750 проц SETPARAM(реф PARAM,VL,ARGTYPE$,DEFVAL,MINVAL,MAXVAL) цлосед1760   импор
1640   BP:+11650   BUF$(BP:BP):=C$1651   //принт "BP=",BP1660 ендпроц PUTBACK1670 //1680 //GETPBC$ - GET A (POSSIBLY PUSHED BACK) CHARACTER1690 //1700 фунц GETPBC$(реф C$) цлосед1710   импорт GETC$1720   импорт BUF$,BP1721   //принт "GETPBC$"AGE("DEFINE:MISSING LEFT PAREN")1990   елиф ISLETTER(GETTOK$(TOKEN$,TOKSIZE))=фалсе тхен2000     MESSAGE("DEFINE:NON-ALPHANUMERIC NAME")2010   елиф GETPBC$(C$)<>"," тхен2020     MESSAGE("DEFINE:MISSING COMMA IN DEFINE")2030   елсе //GOT '(NAME,' SO 10         DEFN$(I:I):=GETPBC$(C$)2111         иф C$=цхр$(92) тхен2120           ERROR("DEFINE:MISSING RIGHT PAREN.")2130         елиф C$="(" тхен2140           NLPAR:+12150         елиф C$=")" тхен2160           NLPAR:-12170           //ELSE NORMпорт INITHASH2290   импорт DEFNAME$,BP2300   DEFNAME$:="DEFINE"+цхр$(0)2310   BP:=02320   INITHASH2330 ендпроц INITDEF2340 //2350 //INITHASH - INITIALISE HASH TABLE AND LINKED LIST ARRAYS2360 //2370 проц INITHASH цлосед2380   импорт HASHTAB(),NNAME(I):=02440     P'DEFN(I):=02450     P'KIND$(I):=цхр$(0)2460     P'NEXTPTR(I):=02470   ендфор I2480 ендпроц INITHASH2490 //2500 //LOOKUP - LOCATE NAME, GET DEFN AND TYPE FROM TABLE2510 //2520 фунц LOOKUP(реф NAME$,реф DEFN$,реф T$) цлосед2532600 ендфунц LOOKUP2610 //2620 //HASHFIND - FIND NAME IN HASH TABL     E2630 //2640 фунц HASHFIND(NAME$) цлосед2650   импорт HASH,CSCOPY,EQUAL2660   импорт HASHTAB(),NDTABLE$,P'NAME(),P'NEXTPTR()2661   //принт "HASHFIND"2670   дим TEMPNAME$ оф 15=P'NEXTPTR(P)2751       //принт "P=",P2760     ендиф 2770   ендвхиле 2780   ретурн P2790 ендфунц HASHFIND2800 //2810 //HASH - COMPUTE HASH FUNCTION OF NAME2820 //2830 фунц HASH(NAME$) цлосед2840   импорт LENGTH,PUTSTR,PUTCF2850   импорт HASHSI90 ендфунц HASH2900 //2910 //INSTALL - ADD NAME,DEFINITION AND TYPE TO TABLE2920 //2930 проц INSTALL(NAME$,DEFN$,T$) цлосед2940   импорт LENGTH,PUTSTR,ERROR,HASH,SCCOPY2950   импорт MAXCHARS,P'NAME(),P'DEFN(),P'KIND$(),P'NEXTPTR(),NDPTR,NEXTTAB2960     ERROR(": TOO MANY DEFINITIONS.")3020   елсе //PUT IT AT FRONT OF CHAIN3030     H:=HASH(NAME$)3031     //принт "H=",H3040     NDPTR:+13041     //принт "NDPTR=",NDPTR3050     P:=NDPTR3051     //принт "P=",P3060     P'NEXTPTR(P):=HASHTAB(H)30 3111     //принт "P'DEFN(P)=",NEXTTAB3120     SCCOPY(DEFN$,NDTABLE$,NEXTTAB)3130     NEXTTAB:+DLEN3131     //принт "NEXTTAB=",NEXTTAB3140     P'KIND$(P):=T$3150   ендиф 3160 ендпроц INSTALL3170 //3180 //SCCOPY-COPY STRING S TO CB(I)...3190 //31722   //принт "BP=",BP1730   иф BP>0 тхен1740     C$:=BUF$(BP:BP)1750   елсе 1760     BP:=11770     BUF$(BP:BP):=GETC$(C$)1780   ендиф 1790   иф C$<>цхр$(92) тхен BP:-11791   //принт "C$=",C$1800   ретурн C$1810 ендфунц GETPBC$1820 //1830 //EN$,TOKSIZE,реф DEFN$,DEFSIZE) цлосед1930   импорт GETPBC$,MESSAGE,ISLETTER,PUTBACK,ERROR,GETTOK$1931   //принт "GETDEF"1940   дим C$ оф 11950   TOKEN$:=цхр$(0) //IN CASE OF BADINPUT1960   DEFN$:=цхр$(0)1970   иф GETPBC$(C$)<>"(" тхен1980     MESSFAR2040     вхиле GETPBC$(C$)=" " до нулл //SKIP SPACES2050     PUTBACK(C$) //WENT ONE TOO FAR2060     NLPAR:=02070     I:=12080     вхиле NLPAR>=0 до2090       иф I>=DEFSIZE тхен2100         ERROR("DEFINE:DEFINITION TOO LONG")2101       елсе 21AL CHARACTER2180         ендиф 2190         I:+12191       ендиф 2200     ендвхиле 2210     DEFN$(I-1:I-1):=цхр$(0)2220   ендиф 2230 ендпроц GETDEF2240 //2250 //INITDEF - INITIALISE VARIABLES FOR DEFINE2260 //2270 проц INITDEF цлосед2280   имDPTR,P'NAME(),P'DEFN(),P'KIND$(),P'NEXTPTR(),HASHSIZE2381   импорт NDTABLE$,NEXTTAB2390   NEXTTAB:=1 //FIRST FREE SLOT IN HASHTABLE2400   NDPTR:=0 //CURRENT POINTER TO LINKED LIST ARRAY2410   фор I:=1 то HASHSIZE до2420     HASHTAB(I):=02430     P'0   импорт HASHFIND,CSCOPY2540   импорт NDTABLE$,P'DEFN(),P'KIND$()2541   //принт "LOOKUP"2550   P:=HASHFIND(NAME$)2551   //принт "P=",P2560   иф P=0 тхен ретурн фалсе2570   CSCOPY(NDTABLE$,P'DEFN(P),DEFN$)2580   T$:=P'KIND$(P)2590   ретурн труе02680   FOUND:=фалсе2690   P:=HASHTAB(HASH(NAME$))2691   //принт "P=",P2700   вхиле FOUND=фалсе анд P<>0 до2710     CSCOPY(NDTABLE$,P'NAME(P),TEMPNAME$)2720     иф EQUAL(NAME$,TEMPNAME$)=труе тхен2730       FOUND:=труе2740     елсе 2750       P:ZE2851   //принт "HASH"2852   //PUTSTR(NAME$,7)2853   //PUTCF(""13"",7)2860   H:=02870   фор I:=1 то LENGTH(NAME$) до2871     H:=(3*H+орд(NAME$(I:I))) мод HASHSIZE2872     //принт "H=",H2873   ендфор I2874   //принт "H=",H+12880   ретурн H+1280   импорт NDTABLE$,HASHTAB()2961   //принт "INSTALL"2970   NLEN:=LENGTH(NAME$)+1 //1 FOR ENDSTR2971   //принт "NLEN=",NLEN2980   DLEN:=LENGTH(DEFN$)+12981   //принт "DLEN=",DLEN2990   иф NEXTTAB+NLEN+DLEN>MAXCHARS тхен3000     PUTSTR(NAME$,7)301	61     //принт "P'NEXTPTR(P)=",HASHTAB(H)3070     HASHTAB(H):=P3071     //принт "HASHTAB(H)=",P3080     P'NAME(P):=NEXTTAB3081     //принт "P'NAME(P)=",NEXTTAB3090     SCCOPY(NAME$,NDTABLE$,NEXTTAB)3100     NEXTTAB:+NLEN3110     P'DEFN(P):=NEXTTABPBSTR - PUSH STRING BACK ONTO INPUT1840 //1850 проц PBSTR(S$) цлосед1860   импорт LENGTH,PUTBACK1870   фор I:=LENGTH(S$) то 1 степ -1 до PUTBACK(S$(I))1880 ендпроц PBSTR1890 //1900 //GETDEF -GET NAME AND DEFINITION1910 //1920 проц GETDEF(реф TOK
200   репеат 0210     LINENO:+10220     F1:=GETLINE(LINE1$,INFILE1,150)0230     F2:=GETLINE(LINE2$,INFILE2,150)0240     иф F1=труе анд F2=труе тхен0250       иф EQUAL(LINE1$,LINE2$)=фалсе тхен DIFFMSG(LINENO,LINE1$,LINE2$)0260     ендиф 0270   унт1, WARNING$ оф 10140   WARNING$:=цхр$(94)0150   N:=10160   LASTC$:=GETC$(C$)0170   вхиле LASTC$<>цхр$(92) до0180     иф GETC$(C$)=цхр$(92) тхен0190       иф N>2 ор LASTC$=WARNING$ тхен0200         PUTREP(N,LASTC$)0210       елсе 0220         PUT0   //0350   //PUTREP-PUT OUT A RUN OF N C$'S0360   //0370   проц PUTREP(N,C$) цлосед0380     импорт WARNING$,PUTC,MIN0390     MAXREP:=26 //ASSUMING а..з0400     THRESH:=40410     вхиле N>=THRESH ор C$=WARNING$ анд N>0 до0420       PUTC(WARNING$) 0 ендфунц GETTOK$1570 //1580 //PUTBACK - PUSH CHARACTER BACK ONTO INPUT1590 //1600 проц PUTBACK(C$) цлосед1610   импорт ERROR1620   импорт BUF$,BP,BUFSIZE1621   //принт "PUTBACK"1630   иф BP>=BUFSIZE тхен ERROR("TOO MANY CHARACTERS PUSHED BACK.") ╧ S$ оф 1500140   фор I:=1 то NARGS до0150     JUNK:=GETARG(I,S$,150)0160     FD:=MUSTOPEN(S$,0)0170     FCOPY(FD,6)0180     XCLOSE(FD)0190   ендфор I0200 ендпроц CONCAT0210 // 2$(92) до PUTC(C$)0150 ендпроц COPY'PROC0160 //UFSIZE:=500 //SIZE OF PUSHBACK BUFFER1040   MAXCHARS:=5000 //SIZE OF NAME-DEFN TABLE1050   MAXDEF:=150 //MAX CHARS IN A DEFN1060   MAXTOK:=150 //MAX CHARS IN A TOKEN1070   HASHSIZE:=53 //SIZE OF HASH TABLE1080   дим HASHTAB(1:HASHSIZE), NDTABLE$ оф E$ оф 11150   NUL$:=цхр$(0)1160   INITDEF1170   INSTALL(DEFNAME$,NUL$,цхр$(200))1180   вхиле GETTOK$(TOKEN$,MAXTOK)<>цхр$(92) до1190     иф ISLETTER(TOKEN$(1:1))=фалсе тхен1200       PUTSTR(TOKEN$,6)1210     елиф LOOKUP(TOKEN$,DEFN$,TOKTYPE$)=фалс     ендиф 1290   ендвхиле 1300 ендпроц DEFINE1310 //1320 //GETTOK - GET TOKEN FOR DEFINE1330 //1340 фунц GETTOK$(реф TOK$,TOKSIZE) цлосед1350   импорт ISALPHANUM,GETPBC$,ERROR,PUTBACK1351   //принт "GETTOK$"1359   дим C$ оф 11360   I:=11370    иф I>=TOKSIZE тхен1470     ERROR("TOKEN TOO LONG.")1480   ендиф 1490   иф I>1 тхен //SOME ALPHA WAS SEEN1500     PUTBACK(TOK$(I:I))1510     I:-11520   ендиф 1530   //ELSE SINGLE NON-ALPHA1540   TOK$(I+1:I+1):=цхр$(0)1550   ретурн TOK$(1:1)156ил F1=фалсе ор F2=фалсе0280   иф F2=труе анд F1=фалсе тхен0290     MESSAGE("еоф ON FILE1")0300   елиф F1=труе анд F2=фалсе тхен0310     MESSAGE("еоф ON FILE2")0320   ендиф 0330 ендпроц COMPARE0340 //0350 //DIFFMSG-PRINT LINE NUMBERS AND DIFFERING0010 PROG$:="цомпресс"0020 //0030 //COMPRESS-COMPRESS STANDARD INPUT0040 //0050 INIT //INITIALISE0060 COMPRESS0070 FINIT //FINALISE0080 енд 0090 //0100 //COMPRESS-COMPRESS STANDARD INPUT0110 //0120 проц COMPRESS 0130   дим C$ оф 1, LASTC$ оф C(LASTC$)0230       ендиф 0240     елиф C$=LASTC$ тхен0250       N:+10260     елиф N>1 ор LASTC$=WARNING$ тхен0270       PUTREP(N,LASTC$)0280       N:=10290     елсе 0300       PUTC(LASTC$)0310     ендиф 0320     LASTC$:=C$0330   ендвхиле 034 е0430       PUTC(цхр$(MIN(N,MAXREP)-1+орд("а")))0440       PUTC(C$)0450       N:-MAXREP0460     ендвхиле 0470     фор N:=N то 1 степ -1 до PUTC(C$)0480   ендпроц PUTREP0490 ендпроц COMPRESS0010 PROG$:="цонцат"0020 //0030 //CONCAT-CONCATENATE FILES ONTO STANDARD OUTPUT0040 //0050 INIT //INITIALISE0060 CONCAT0070 FINIT //FINALISE0080 енд 0090 //0100 //CONCAT-CONCATENATE FILES ONTO STANDARD OUTPUT0110 //0120 проц CONCAT 0130   дим0010 PROG$:="цопы"0020 //0030 //COPY-COPY INPUT TO OUTPUT0040 //0050 INIT //INITIALISE0060 COPY'PROC0070 FINIT //FINALISE0080 енд 0090 //0100 //COPY-COPY INPUT TO OUTPUT0110 //0120 проц COPY'PROC 0130   дим C$ оф 10140   вхиле GETC$(C$)<>цхр0010 PROG$:="дефине"0020 //0030 //DEFINE - SIMPLE STRING REPLACEMENT MACRO PROCESSOR0040 //0050 INIT //INITIALISE0060 DEFINE0070 FINIT //FINALISE0080 енд 1000 //DEFINE - SIMPLE STRING REPLACEMENT MACRO PROCESSOR1010 //1020 проц DEFINE 1030   BMAXCHARS, BUF$ оф BUFSIZE1090   дим P'NAME(1:HASHSIZE), P'DEFN(1:HASHSIZE), P'KIND$(1:HASHSIZE) оф 11100   дим P'NEXTPTR(1:HASHSIZE)1110   NDPTR:=01120   BP:=01121   NEXTTAB:=01130   дим DEFN$ оф 150, TOKEN$ оф 150, DEFNAME$ оф 7, NUL$ оф 1, TOKTYPе тхен1220       PUTSTR(TOKEN$,6) //UNDEFINED1230     елиф TOKTYPE$=цхр$(200) тхен //DEFN1240       GETDEF(TOKEN$,MAXTOK,DEFN$,MAXDEF)1250       INSTALL(TOKEN$,DEFN$,цхр$(201))1260     елсе 1270       PBSTR(DEFN$) //PUSH REPLACEMENT ONTO INPUT1280	 DONE:=фалсе1380   TOK$:=спц$(150)1390   вхиле DONE=фалсе анд I<=TOKSIZE до1398     C$:=GETPBC$(C$)1399     TOK$(I:I):=C$1400     иф ISALPHANUM(C$)=труе тхен1410       I:+11420     елсе 1430       DONE:=труе1440     ендиф 1450   ендвхиле 1460  Ю LINES0360 //0370 проц DIFFMSG(N,LINE1$,LINE2$) цлосед0380   импорт PUTDEC,PUTC,PUTSTR0390   PUTDEC(N,1)0400   PUTC(":")0410   PUTC(""13"")0420   PUTSTR(LINE1$,6)0430   PUTSTR(LINE2$,6)0440 ендпроц DIFFMSG0450 //
ц TPRINT1910 //1920 //GETWORD-GET WORD FROM S$(I) INTO OUT$1930 //1940 фунц GETWORD(S$,I,реф OUT$) цлосед1950   вхиле S$(I)=" " ор S$(I)=""13"" до I:+11960   J:=11970   OUT$:=""1980   вхиле S$(I)<>""0"" анд S$(I)<>" " анд S$(I)<>""13"" до1990   ("UNEXPECTED еоф IN FSKIP")2260   ендфор I2270 ендпроц FSKIP2280 //2290 //FILEARG-CHECK IF NAME MATCHES ARGUMENT LIST2300 //2310 фунц FILEARG(NAME$) цлосед2320   импорт EQUAL,NFILES,FNAME$(),FSTAT()2330   иф NFILES<=0 тхен ретурн труе2340   FOUN460 //NOTFOUND-PRINT NOT FOUND WARNING2470 //2480 проц NOTFOUND цлосед2490   импорт PUTSTR,MESSAGE,NFILES,ERRCOUNT,FNAME$(),FSTAT()2500   фор I:=1 то NFILES до2510     иф FSTAT(I)=фалсе тхен2520       PUTSTR(FNAME$(I),7)2530       MESSAGE(": NOT IOPY,XCLOSE2630   импорт NOTFOUND,ERRCOUNT2640   дим ENAME$ оф 150, INLINE$ оф 1502650   AFD:=MUSTOPEN(ANAME$,0)2660   иф CMD$="P" тхен2670     EFD:=62680   елсе //CMD IS X2690     EFD:=02700   ендиф 2710   вхиле GETHDR(AFD,INLINE$,ENAME$,SIZE)=т12800         FSKIP(AFD,SIZE)2810       елсе 2820         ACOPY(AFD,EFD,SIZE)2830         иф EFD<>6 тхен XCLOSE(EFD)2840       ендиф 2850     ендиф 2860   ендвхиле 2870   NOTFOUND2880 ендпроц EXTRACT2890 //2900 //ACOPY-COPY N CHARACTERS FROM Fиф 3010   ендфор I3020 ендпроц ACOPY3030 //3040 //KILL-DELETE FILES FROM ARCHIVE3050 //3060 проц KILL(ANAME$) цлосед3070   импорт ERROR,MUSTOPEN,MUSTCREATE,REPLACE,NOTFOUND,XCLOSE,FMOVE,XOPEN3080   импорт MESSAGE,XREMOVE3090   импорт NFILES,ERRC180   XCLOSE(TFD)3190   иф ERRCOUNT=0 тхен3200     FMOVE(ARCHTEMP$,ANAME$)3210   елсе 3220     MESSAGE("FATAL ERRORS-ARCHIVE NOT ALTERED")3230   ендиф 3240   TFD:=XOPEN(ARCHTEMP$,0)3250   XREMOVE(TFD)3260 ендпроц KILL3270 //3280 //REPLACE-REPLA В3350       иф CMD$="U" тхен ADDFILE(UNAME$,TFD) //ADD NEW ONE3360       FSKIP(AFD,SIZE) //DISCARD OLD ONE3370     елсе 3380       PUTSTR(INLINE$,TFD)3390       ACOPY(AFD,TFD,SIZE)3400     ендиф 3410   ендвхиле 3420 ендпроц REPLACE3430 // }40   NC:=00150   вхиле GETC$(C$)<>цхр$(92) до NC:+10160   PUTDEC(NC,1)0170   PUTC(""13"")0180 ендпроц CHARCOUNT0190 // 150, LINE2$ оф 150, ARG1$ оф 150, ARG2$ оф 1500140   иф GETARG(1,ARG1$,150)=фалсе ор GETARG(2,ARG2$,150)=фалсе тхен0150     ERROR("USAGE: FILE1 FILE2")0160   ендиф 0170   INFILE1:=MUSTOPEN(ARG1$,0)0180   INFILE2:=MUSTOPEN(ARG2$,0)0190   LINENO:=00  OUT$:+S$(I)2000     I:+12010     J:+12020   ендвхиле 2030   OUT$:+""0""2040   иф S$(I)=""0"" тхен ретурн 02050   ретурн I2060 ендфунц GETWORD2070 //2080 фунц GETHDR(FD,реф BUF$,реф NAME$,реф SIZE) цлосед2090   импорт GETLINE,GETWORD,EQUAL,ERRCTOI(BUF$,I)2160   ретурн труе2170 ендфунц GETHDR2180 //2190 //FSKIP-SKIP N CHARACTERS ON FILE FD2200 //2210 проц FSKIP(FD,N) цлосед2220   импорт GETCF$,ERROR2230   дим C$ оф 12240   фор I:=1 то N до2250     иф GETCF$(C$,FD)=цхр$(92) тхен ERRORD:=фалсе2350   I:=12360   вхиле FOUND=фалсе анд I<=NFILES до2370     иф EQUAL(NAME$,FNAME$(I))=труе тхен2380       FSTAT(I):=труе2390       FOUND:=труе2400     ендиф 2410     I:+12420   ендвхиле 2430   ретурн FOUND2440 ендфунц FILEARG2450 //2N ARCHIVE")2540       ERRCOUNT:+12550     ендиф 2560   ендфор I2570 ендпроц NOTFOUND2580 //2590 //EXTRACT-EXTRACT FILES FROM ARCHIVE2600 //2610 проц EXTRACT(ANAME$,CMD$) цлосед2620   импорт MUSTOPEN,GETHDR,FILEARG,FSKIP,XCREATE,PUTSTR,MESSAGE,ACруе до2720     иф FILEARG(ENAME$)=фалсе тхен2730       FSKIP(AFD,SIZE)2740     елсе 2750       иф EFD<>6 тхен EFD:=XCREATE(ENAME$,1)2760       иф EFD=0 тхен2770         PUTSTR(ENAME$,7)2780         MESSAGE(": CAN'T CREATE")2790         ERRCOUNT:+DI TO FDO2910 //2920 проц ACOPY(FDI,FDO,N) цлосед2930   импорт GETCF$,ERROR,PUTCF2940   дим C$ оф 12950   фор I:=1 то N до2960     иф GETCF$(C$,FDI)=цхр$(92) тхен2970       ERROR("еоф IN ACOPY")2980     елсе 2990       PUTCF(C$,FDO)3000     ендOUNT,ARCHTEMP$3100   иф NFILES<=0 тхен //PROTECT INNOCENTD3110     ERROR("-D REQUIRES EXPLICIT FILENAMES")3120   ендиф 3130   AFD:=MUSTOPEN(ANAME$,0)3140   TFD:=MUSTCREATE(ARCHTEMP$,1)3150   REPLACE(AFD,TFD,"D")3160   NOTFOUND3170   XCLOSE(AFD)3CE OR DELETE FILES3290 //3300 проц REPLACE(AFD,TFD,CMD$) цлосед3310   импорт GETHDR,FILEARG,ADDFILE,FSKIP,PUTSTR,ACOPY3320   дим INLINE$ оф 150, UNAME$ оф 1503330   вхиле GETHDR(AFD,INLINE$,UNAME$,SIZE)=труе до3340     иф FILEARG(UNAME$)=труе тхен0010 PROG$:="цхарцоунт"0020 //0030 //CHARCOUNT-COUNT CHARACTERS ON INPUT0040 //0050 INIT //INITIALISE0060 CHARCOUNT0070 FINIT //FINALISE0080 енд 0090 //0100 //CHARCOUNT-COUNT CHARACTERS ON INPUT0110 //0120 проц CHARCOUNT 0130   дим C$ оф 101	0010 PROG$:="цомпаре"0020 //0030 //COMPARE-COMPARE TWO FILES FOR EQUALITY0040 //0050 INIT //INITIALISE0060 COMPARE0070 FINIT //FINALISE0080 енд 0090 //0100 //COMPARE-COMPARE TWO FILES FOR EQUALITY0110 //0120 проц COMPARE 0130   дим LINE1$ оф OR,CTOI,ARCHHDR$2100   дим TEMP$ оф 1502110   иф GETLINE(BUF$,FD,150)=фалсе тхен ретурн фалсе2120   I:=GETWORD(BUF$,1,TEMP$)2130   иф EQUAL(TEMP$,ARCHHDR$)=фалсе тхен ERROR("ARCHIVE NOT IN PROPER FORMAT")2140   I:=GETWORD(BUF$,I,NAME$)2150   SIZE:=
0010 PROG$:="арцхиже"0020 //0030 //ARCHIVE-FILE MAINTAINER0040 //0050 INIT //INITIALISE0060 ARCHIVE0070 FINIT //FINALISE0080 енд 0090 //0100 //ARCHIVE-FILE MAINTAINER0110 //0120 проц ARCHIVE 0130   MAXFILES:=100 //OR WHATEVER0140   дим ANAMELL(ANAME$)0390   отхервисе 0400     HELP0410   ендцасе 0420 ендпроц ARCHIVE0430 //0440 //INITARCH-INITIALISE VARIABLE FOR ARCHIVE0450 //0460 проц INITARCH 0470   ARCHTEMP$:="ARTEMP"0""0480   ARCHHDR$:="-H-"0""0490 ендпроц INITARCH0500 //0510ERRCOUNT,NFILES,NARGS,MAXFILES,ERROR,GETARG,FNAME$(),FSTAT()0610   импорт EQUAL,PUTSTR0620   ERRCOUNT:=00630   NFILES:=NARGS-20640   иф NFILES>MAXFILES тхен ERROR("TOO MANY FILE NAMES")0650   фор I:=1 то NFILES до JUNK:=GETARG(I+2,FNAME$(I),150)06630     ендфор J0740   ендфор I0750 ендпроц GETFNS0760 //0770 //UPDATE-UPDATE EXISTING FILES, ADD NEW ONES AT END0780 //0790 проц UPDATE(ANAME$,CMD$) цлосед0800   импорт MUSTCREATE,MUSTOPEN,REPLACE,XCLOSE,ADDFILE,FMOVE,MESSAGE,XOPEN0810   импорт Nо //ADD NEW ONES0890     иф FSTAT(I)=фалсе тхен0900       ADDFILE(FNAME$(I),TFD)0910       FSTAT(I):=труе0920     ендиф 0930   ендфор I0940   XCLOSE(TFD)0950   иф ERRCOUNT=0 тхен0960     FMOVE(ARCHTEMP$,ANAME$)0970   елсе 0980     MESSAGE("FATA   FD1:=MUSTOPEN(NAME1$,0)1090   FD2:=MUSTCREATE(NAME2$,1)1100   FCOPY(FD1,FD2)1110   XCLOSE(FD1)1120   XCLOSE(FD2)1130 ендпроц FMOVE1140 //1150 //ADDFILE-ADD FILE NAME TO ARCHIVE1160 //1170 проц ADDFILE(NAME$,FD) цлосед1180   импорт XOPEN,PUTS1260   иф ERRCOUNT=0 тхен1270     MAKEHDR(NAME$,HEAD$)1280     PUTSTR(HEAD$,FD)1281     NFD:=XOPEN(NAME$,0) //RE-OPEN FOR FCOPY1290     FCOPY(NFD,FD)1300     XCLOSE(NFD)1310   ендиф 1320 ендпроц ADDFILE1330 //1340 //MAKEHDR-MAKE HEADER LINE FOR1,HEAD$,I+1)1440   I:=LENGTH(HEAD$)+11450   CHAR$:=стр$(FSIZE(NAME$))+""0""1460   HEAD$(I):=" "1470   SCOPY(CHAR$,1,HEAD$,I+1)1480   I:=LENGTH(HEAD$)+11490   HEAD$(I):=""13""1500   HEAD$(I+1):=""0""1510 ендпроц MAKEHDR1520 //1530 //FSIZE-SIZE O1640 //1650 //TABLE-PRINT TABLE OF ARCHIVE CONTENTS1660 //1670 проц TABLE(ANAME$) цлосед1680   импорт MUSTOPEN,GETHDR,FILEARG,TPRINT,FSKIP,NOTFOUND1690   дим HEAD$ оф 150, NAME$ оф 1501700   AFD:=MUSTOPEN(ANAME$,0)1710   вхиле GETHDR(AFD,HEAD$,NAM WORD,PUTSTR,PUTC1820   дим TEMP$ оф 1501830   I:=GETWORD(BUF$,1,TEMP$) //HEADER1840   I:=GETWORD(BUF$,I,TEMP$) //NAME1850   PUTSTR(TEMP$,6)1860   PUTC(" ")1870   I:=GETWORD(BUF$,I,TEMP$) //SIZE1880   PUTSTR(TEMP$,6)1890   PUTC(""13"")1900 ендпро$ оф 150 //ARCHIVE NAME0150   дим CMD$ оф 150 //COMMAD TYPE0160   дим FNAME$(MAXFILES) оф 150 //FILENAME ARGS0170   дим FSTAT(MAXFILES) //TRUE=IN ARCHIVE0180   NFILES:=0 //NUMBER OF FILENAME ARGS0190   ERRCOUNT:=0 //NUMBER OF ERRORS0200   дим ARCHTMD$(2) оф0270   вхен "C"0280     UPDATE(ANAME$,"C")0290   вхен "U"0300     UPDATE(ANAME$,"U")0310   вхен "T"0320     TABLE(ANAME$)0330   вхен "X"0340     EXTRACT(ANAME$,"X")0350   вхен "P"0360     EXTRACT(ANAME$,"P")0370   вхен "D"0380     KI //HELP-PRINT DIAGNOSTIC FOR ARCHIVE0520 //0530 проц HELP 0540   ERROR("USAGE: ARCHIVE -(CDPTUX) ARCHNAME [FILES...]")0550 ендпроц HELP0560 //0570 //GETFNS-GET FILENAMES INTO FNAME, LOOK FOR DUPLICATES0580 //0590 проц GETFNS цлосед0600   импорт 0   фор I:=1 то NFILES до FSTAT(I):=фалсе0670   фор I:=1 то NFILES-1 до0680     фор J:=I+1 то NFILES до0690       иф EQUAL(FNAME$(I),FNAME$(J))=труе тхен0700         PUTSTR(FNAME$(I),7)0710         ERROR(": DUPLICATE FILE NAME")0720       ендиф 07FILES,FSTAT(),FNAME$(),ARCHTEMP$,ERRCOUNT,XREMOVE0820   TFD:=MUSTCREATE(ARCHTEMP$,1)0830   иф CMD$="U" тхен0840     AFD:=MUSTOPEN(ANAME$,0)0850     REPLACE(AFD,TFD,"U") //REPLACE EXISTING0860     XCLOSE(AFD)0870   ендиф 0880   фор I:=1 то NFILES дL ERRORS-ARCHIVE NOT ALTERED")0990   ендиф 1000   TFD:=XOPEN(ARCHTEMP$,0)1010   XREMOVE(TFD)1020 ендпроц UPDATE1030 //1040 //FMOVE-MOVE NAME1 TO NAME21050 //1060 проц FMOVE(NAME1$,NAME2$) цлосед1070   импорт MUSTOPEN,MUSTCREATE,FCOPY,XCLOSE1080TR,MESSAGE,FCOPY,XCLOSE,MAKEHDR,ERRCOUNT1190   дим HEAD$ оф 1501200   NFD:=XOPEN(NAME$,0)1210   иф NFD=0 тхен1220     PUTSTR(NAME$,7)1230     MESSAGE(": CAN'T ADD")1240     ERRCOUNT:+11250   ендиф 1251   XCLOSE(NFD) //SO THAT FSIZE CAN RE-OPEN IT ARCHIVE MEMBER1350 //1360 проц MAKEHDR(NAME$,реф HEAD$) цлосед1370   импорт SCOPY,LENGTH,FSIZE,ARCHHDR$1380   дим CHAR$ оф 201390   HEAD$:=спц$(150)1400   SCOPY(ARCHHDR$,1,HEAD$,1)1410   I:=LENGTH(HEAD$)+11420   HEAD$(I):=" "1430   SCOPY(NAME$,F FILE IN CHARACTERS1540 //1550 фунц FSIZE(NAME$) цлосед1560   импорт MUSTOPEN,GETCF$,XCLOSE1570   дим C$ оф 11580   N:=01590   FD:=MUSTOPEN(NAME$,0)1600   вхиле GETCF$(C$,FD)<>цхр$(92) до N:+11610   XCLOSE(FD)1620   ретурн N1630 ендфунц FSIZE	E$,SIZE)=труе до1720     иф FILEARG(NAME$)=труе тхен TPRINT(HEAD$)1730     FSKIP(AFD,SIZE)1740   ендвхиле 1750   NOTFOUND1760 ендпроц TABLE1770 //1780 //TPRINT-PRINTTABLE ENTRY FOR ONE MEMBER1790 //1800 проц TPRINT(BUF$) цлосед1810   импорт GETEMP$ оф 150 //TEMP FILENAME 'ARTEMP'0210   дим ARCHHDR$ оф 4 //HEADER STRING '-H-'0220   INITARCH0230   иф GETARG(1,CMD$,150)=фалсе ор GETARG(2,ANAME$,150)=фалсе тхен HELP0240   GETFNS0250   иф LENGTH(CMD$)<>2 ор CMD$(1)<>"-" тхен HELP0260   цасе CAЪЪЪЪЪЪЪЪПц                                                lш                                                Н╨ЪЪЪЪЪЪЪЪ═════════════════════2A════│M.WORDCOUNT═════            │M.UNROTATE══════            │
M.UNIQUE════════            │M.TRANSLIT══════            │M.SORT══════════            │M.PRINT═════════            │
M.MACRO═════════         
   │ M.LINECOUNT═════          KK│M.KWIC══════════          │M.INCLUDE═══════          │M.FORMAT════════          │M.FIND══════════          │ M.EXPAND════════          │M.ECHO══════════          │M.DEFINE════════          │M.COPY══════════          KK
│M.CONCAT════════          │M.COMPRESS══════          │M.COMPARE═══════          │M.CHARCOUNT═════          │M.CHANGE════════          │M.ARCHIVE═══════          │
L.WORDCOUNT═════          │L.UNROTATE══════          KK│L.UNIQUE════════          │L.TRANSLIT══════          │L.SORT══════════          │L.SKEL══════════          │L.PRINT═════════          │L.PRIMS═════════         9 │L.MACRO═════════         A │L.LINECOUNT═════          KK│L.KWIC══════════          │ L.INCLUDE═══════          │L.FORMAT════════         1 │L.FIND══════════           │L.EXPAND════════          │
L.ECHO══════════          │L.DEFINE════════           │L.COPY══════════          KK Ъ│L.CONCAT════════          │L.COMPRESS══════          │L.COMPARE═══════          │L.CHARCOUNT═════          │ L.CHANGE════════         ' │ L.ARCHIVE═══════         &   KK
0010 PROG$:="цханге"0020 //0030 //CHANGE 'FROM' TO 'TO' AND PRINT0040 //0050 INIT //INITIALISE0060 CHANGE0070 FINIT //FINALISE0080 енд 0090 //0100 //CHANGE-CHANGE 'FROM' TO 'TO'0110 //0120 проц CHANGE 0130   дим CLOSURE$ оф 1, BOL$ оф 1, EOL$ еф PAT$) цлосед1660   импорт ADDSTR,GETCCL,STCLOSE,META$1670   импорт ANY$,MAXPAT,BOL$,EOL$,CCL$,CLOSURE$,LITCHAR$1680   J:=1 //PAT$ INDEX1690   I:=START //ARG$ INDEX1700   LASTJ:=11710   DONE:=фалсе1720   вхиле DONE=фалсе анд ARG$(I)<>DELIM$ анд 63)0210   CCL$:=цхр$(91)0220   CCLEND$:=цхр$(93)0230   NEGATE$:=цхр$(94)0240   NCCL$:=цхр$(33)0250   LITCHAR$:=цхр$(67)0260   дим ARG$ оф 150, LIN$ оф 150, PAT$ оф 150, SUB$ оф 1500270   иф GETARG(1,ARG$,150)=фалсе тхен ERROR("USAGE: CHANGE FROM [CAN'T HAPPEN")1020   ендцасе 1030 ендфунц PATSIZE1040 //1050 //OMATCH-MATCH ONE PATTERN ELEMENT AT PAT(J)1060 //1070 фунц OMATCH(LIN$,реф I,PAT$,J) цлосед1080   импорт ERROR,LOCATE1090   импорт LITCHAR$,BOL$,EOL$,ANY$,CCL$,NCCL$,CLOSURE$1100   A,SUB$)0320 ендпроц CHANGE0330 //0480 //AMATCH-LOOK FOR MATCH AT PAT(J)... AT LIN(OFFSET)...0490 //0500 фунц AMATCH(LIN$,OFFSET,PAT$,J) цлосед0510   импорт PATSIZE,OMATCH0520   импорт CLOSURE$0530   DONE:=фалсе0540   вхиле DONE=фалсе анд PAT$(J)<190   вхен EOL$1200     иф LIN$(I)=""13"" тхен ADVANCE:=01210   вхен CCL$1220     иф LOCATE(LIN$(I),PAT$,J+1)=труе тхен ADVANCE:=11230   вхен NCCL$1240     иф LIN$(I)<>""13"" тхен1250       иф LOCATE(LIN$(I),PAT$,J+1)=фалсе тхен ADVANCE:=11260    ONE:=труе0610       ендвхиле 0620       //I POINTS TO INPUT CHARACTER THAT MADE US FAIL0630       //MATCH REST OF PATTERN AGAINST REST OF INPUT0640       //SHRINK CLOSURE BY 1 AFTER EACH FAILURE0650       DONE:=фалсе0660       вхиле DONE=фалсе анд N CHARACTER CLASS AT PAT(OFFSET)1390 //1400 фунц LOCATE(C$,PAT$,OFFSET) цлосед1410   //SIZE OF CLASS IS AT PAT(OFFSET),CHARACTERS FOLLOW1420   LOC:=фалсе1430   I:=OFFSET+орд(PAT$(OFFSET)) //LAST POSITION1440   вхиле I>OFFSET до1450     иф C$=PAT$(THEN FAILURE ELSE SUCCESS0750       DONE:=труе0760     елиф OMATCH(LIN$,OFFSET,PAT$,J)=фалсе тхен0770       OFFSET:=0 //NON-CLOSURE0780       DONE:=труе0790     елсе //OMATCH SUCCEEDED ON THIS PATTERN ELEMENT0800       J:+PATSIZE(PAT$,J)0810     еARG$,реф PAT$) цлосед1580   импорт MAKEPAT1590   иф MAKEPAT(ARG$,1,""0"",PAT$)>0 тхен ретурн труе1600   ретурн фалсе1610 ендфунц GETPAT1620 //1630 //MAKEPAT-MAKE PATTERNS FROM ARG(I), TERMINATE AT DELIM1640 //1650 фунц MAKEPAT(ARG$,START,DELIM$,р оф 1, ANY$ оф 1, CCL$ оф 10140   дим CCLEND$ оф 1, NEGATE$ оф 1, NCCL$ оф 1, LITCHAR$ оф 1, DITTO$ оф 10141   DITTO$:=цхр$(2)0150   MAXPAT:=1500160   CLOSIZE:=10170   CLOSURE$:=цхр$(42)0180   BOL$:=цхр$(37)0190   EOL$:=цхр$(36)0200   ANY$:=цхр$(0910   цасе PAT$(N) оф0920   вхен LITCHAR$0930     ретурн 20940   вхен BOL$,EOL$,ANY$0950     ретурн 10960   вхен CCL$,NCCL$0970     ретурн орд(PAT$(N+1))+20980   вхен CLOSURE$0990     ретурн CLOSIZE1000   отхервисе 1010     ERROR("IN PATSIZE: TO]")0280   иф GETPAT(ARG$,PAT$)=фалсе тхен ERROR("ILLEGAL 'FROM'PATTERN")0281   иф GETARG(2,ARG$,150)=фалсе тхен ARG$:=""0""0282   иф GETSUB(ARG$,SUB$)=фалсе тхен ERROR("ILLEGAL 'TO' STRING")0290   вхиле GETLINE(LIN$,5,150)=труе до SUBLINE(LIN$,PAT$DVANCE:=-11110   иф LIN$(I)=""0"" тхен ретурн фалсе1120   цасе PAT$(J) оф1130   вхен LITCHAR$1140     иф LIN$(I)=PAT$(J+1) тхен ADVANCE:=11150   вхен BOL$1160     иф I=1 тхен ADVANCE:=01170   вхен ANY$1180     иф LIN$(I)<>""13"" тхен ADVANCE:=11>""0"" до0550     иф PAT$(J)=CLOSURE$ тхен0560       J:+PATSIZE(PAT$,J) //STEP OVER CLOSURE0570       I:=OFFSET0580       //MATCH AS MANY AS POSSIBLE0590       вхиле DONE=фалсе анд LIN$(I)<>""0"" до0600         иф OMATCH(LIN$,I,PAT$,J)=фалсе тхен D ендиф 1270   отхервисе 1280     ERROR("IN OMATCH: CAN'T HAPPEN")1290   ендцасе 1300   иф ADVANCE>=0 тхен1310     I:+ADVANCE1320     ретурн труе1330   елсе 1340     ретурн фалсе1350   ендиф 1360 ендфунц OMATCH1370 //1380 //LOCATE-LOOK FOR C II>=OFFSET до0670         K:=AMATCH(LIN$,I,PAT$,J+PATSIZE(PAT$,J))0680         иф K>0 тхен //MATCHED REST OF PATTERN0690           DONE:=труе0700         елсе 0710           I:-10720         ендиф 0730       ендвхиле 0740       OFFSET:=K //IF K=0 	I) тхен1460       LOC:=труе1470       I:=OFFSET //FORCE LOOP TERMINATION1480     елсе 1490       I:-11500     ендиф 1510   ендвхиле 1520   ретурн LOC1530 ендфунц LOCATE1540 //1550 //GETPAT-CONVERT ARGUMENT INTO PATTERN1560 //1570 фунц GETPAT(ндиф 0820   ендвхиле 0830   ретурн OFFSET0840 ендфунц AMATCH0850 //0860 //PATSIZE-RETURNS SIZE OF PATTERN ENTRY AT PAT(J)0870 //0880 фунц PATSIZE(PAT$,N) цлосед0890   импорт ERROR0900   импорт LITCHAR$,BOL$,EOL$,ANY$,CCL$,NCCL$,CLOSURE$,CLOSIZE
ARG$(I)<>""0"" до1730     LJ:=J1740     цасе ARG$(I) оф1750     вхен ANY$1760       JUNK:=ADDSTR(ANY$,PAT$,J,MAXPAT)1770     вхен BOL$1780       иф I=START тхен JUNK:=ADDSTR(BOL$,PAT$,J,MAXPAT)1790     вхен EOL$1800       иф ARG$(I+1)=DELIM$ тхен -OUTPUT SUBSTITUTION STRING3570 //3580 проц PUTSUB(LIN$,S1,S2,SUB$) цлосед3590   импорт PUTC3600   импорт DITTO$3610   I:=13620   вхиле SUB$(I)<>""0"" до3630     иф SUB$(I)=DITTO$ тхен3640       фор J:=S1 то S2-1 до PUTC(LIN$(J))3650     елсе 3TJ1900         цасе PAT$(LJ) оф1910         вхен BOL$,EOL$,CLOSURE$1920           DONE:=труе //FORCE LOOP TERMINATION1930         отхервисе 1940           STCLOSE(PAT$,J,LASTJ)1950         ендцасе 1960       ендиф 1970     отхервисе 1980       J      фор K:=орд(SRC$(I-1))+1 то орд(SRC$(I+1)) до2600           JUNK:=ADDSTR(цхр$(K),DEST$,J,MAXSET)2610         ендфор K2620       ендиф 2630       I:+12640     елсе 2650       JUNK:=ADDSTR("-",DEST$,J,MAXSET)2660     ендиф 2670     I:+12680  2060   елиф ADDSTR(""0"",PAT$,J,150)=фалсе тхен //NO ROOM2070     ретурн 02080   елсе //ALL IS WELL2090     ретурн I2100   ендиф 2110 ендфунц MAKEPAT2120 //2130 //GETCCL-EXPAND CHAR CLASS AT ARG(I) INTO PAT(J)2140 //2150 фунц GETCCL(ARG$,реф I,TCH(LIN$,I,PAT$,1)3080     иф M>0 анд LASTM<>M тхен3090       //REPLACE MATCHED TEXT3100       PUTSUB(LIN$,I,M,SUB$)3110       LASTM:=M3120     ендиф 3130     иф M=0 ор M=I тхен3140       //NO MATCH OR NULL MATCH3150       PUTC(LIN$(I))3160     CL$,PAT$,J,MAXPAT)2240   ендиф 2250   JSTART:=J2260   JUNK:=ADDSTR("0",PAT$,J,MAXPAT) //ROOM FOR COUNT2270   DODASH(CCLEND$,ARG$,I,PAT$,J,MAXPAT)2280   PAT$(JSTART):=цхр$(J-JSTART-1)2290   иф ARG$(I)=CCLEND$ тхен ретурн труе2300   ретурн фалсе231иф MAKESUB(ARG$,1,""0"",SUB$)>0 тхен ретурн труе3290   ретурн фалсе3300 ендфунц GETSUB3310 //3320 //MAKESUB-MAKE SUBSTITUTION STRING FROM ARG IN SUB3330 //3340 фунц MAKESUB(ARG$,FROM,DELIM$,реф SUB$) цлосед3350   импорт ADDSTR,META$3360   импорт    JUNK:=ADDSTR(PAT$(JP),PAT$,JT,MAXPAT)2410   ендфор JP2420   J:+CLOSIZE2430   PAT$(LASTJ):=CLOSURE$ //WHERE ORIGINAL PATTERN BEGAN2440 ендпроц STCLOSE2450 //2460 //DODASH-EXPAND SET AT SRC(I) INTO DEST(J), STOP AT DELIM2470 //2480 проц DODASH(D 3450     I:+13460   ендвхиле 3470   иф ARG$(I)<>DELIM$ тхен //MISSING DELIM3480     ретурн 03490   елиф ADDSTR(""0"",SUB$,J,MAXPAT)=фалсе тхен3500     ретурн 03510   елсе 3520     ретурн I3530   ендиф 3540 ендфунц MAKESUB3550 //3560 //PUTSUB JUNK:=ADDSTR(EOL$,PAT$,J,MAXPAT)1810     вхен CCL$1820       иф GETCCL(ARG$,I,PAT$,J)=фалсе тхен1830         DONE:=труе1840       елсе 1850         DONE:=фалсе1860       ендиф 1870     вхен CLOSURE$1880       иф I>START тхен1890         LJ:=LASен2540       JUNK:=ADDSTR(SRC$(I),DEST$,J,MAXSET)2550     елиф J<=1 ор SRC$(I+1)=""0"" тхен2560       JUNK:=ADDSTR("-",DEST$,J,MAXSET)2570     елиф (ISALPHANUM(SRC$(I-1)) анд ISALPHANUM(SRC$(I+1))) тхен2580       иф SRC$(I-1)<=SRC$(I+1) тхен2590   UNK:=ADDSTR(LITCHAR$,PAT$,J,MAXPAT)1990       JUNK:=ADDSTR(META$(ARG$,I),PAT$,J,MAXPAT)2000     ендцасе 2010     LASTJ:=LJ2020     иф DONE=фалсе тхен I:+12030   ендвхиле 2040   иф DONE=труе ор ARG$(I)<>DELIM$ тхен //FINISHED EARLY2050     ретурн 0 ендвхиле 2690 ендпроц DODASH2700 //3000 //SUBLINE-SUBSTITUE SUB FOR PAT IN LIN, PRINT LIN3010 //3020 проц SUBLINE(реф LIN$,PAT$,SUB$) цлосед3030   импорт AMATCH,PUTSUB,PUTC3040   LASTM:=03050   I:=13060   вхиле LIN$(I)<>""0"" до3070     M:=AMAреф PAT$,реф J) цлосед2160   импорт DODASH,ADDSTR2170   импорт NEGATE$,NCCL$,CCL$,CCLEND$,MAXPAT2180   I:+1 //SKIP OVER LBRACK2190   иф ARG$(I)=NEGATE$ тхен2200     JUNK:=ADDSTR(NCCL$,PAT$,J,MAXPAT)2210     I:+12220   елсе 2230     JUNK:=ADDSTR(C  I:+13170     елсе 3180       //SKIP MATCHED TEXT3190       I:=M3200     ендиф 3210   ендвхиле 3220 ендпроц SUBLINE3230 //3240 //GETSUB-GET SUBSTITUTION STRING INTO SUB3250 //3260 фунц GETSUB(ARG$,реф SUB$) цлосед3270   импорт MAKESUB3280   0 ендфунц GETCCL2320 //2330 //STCLOSE-INSERT CLOSURE ENTRY AT PAT(J)2340 //2350 проц STCLOSE(реф PAT$,реф J,LASTJ) цлосед2360   импорт ADDSTR2370   импорт CLOSIZE,MAXPAT,CLOSURE$2380   фор JP:=J-1 то LASTJ степ -1 до2390     JT:=JP+CLOSIZE2400  	MAXPAT,DITTO$3370   J:=13380   I:=FROM3390   вхиле ARG$(I)<>DELIM$ анд ARG$(I)<>""0"" до3400     иф ARG$(I)=цхр$(38) тхен3410       JUNK:=ADDSTR(DITTO$,SUB$,J,MAXPAT)3420     елсе 3430       JUNK:=ADDSTR(META$(ARG$,I),SUB$,J,MAXPAT)3440     ендифELIM$,SRC$,реф I,реф DEST$,реф J,MAXSET) цлосед2490   импорт ADDSTR,META$,ISALPHANUM2500   вхиле SRC$(I)<>DELIM$ анд SRC$(I)<>""0"" до2510     иф SRC$(I)=цхр$(64) тхен2520       JUNK:=ADDSTR(META$(SRC$,I),DEST$,J,MAXSET)2530     елиф SRC$(I)<>"-" тх d660       PUTC(SUB$(I))3670     ендиф 3680     I:+13690   ендвхиле 3700 ендпроц PUTSUB3710 //,ANY$0950     ретурн 10960   вхен CCL$,NCCL$0970     ретурн орд(PAT$(N+1))+20980   вхен CLOSURE$0990     ретурн CLOSIZE1000   отхервисе 1010     ERROR("IN PATSIZE: CAN'T HAPPEN")1020   ендцасе 1030 ендфунц PATSIZE1040 //1050 //OMATCH-MATCH ONE гETARG(I,ARGSTR$,150)=труе до0160     иф I>1 тхен PUTC(" ")0170     фор J:=1 то LENGTH(ARGSTR$) до PUTC(ARGSTR$(J))0180     I:+10190   ендвхиле 0200   иф I>1 тхен PUTC(""13"")0210 ендпроц ECHO$(94)0150   вхиле GETC$(C$)<>цхр$(92) до0160     иф C$<>WARNING$ тхен0170       PUTC(C$)0180     елиф ISUPPER(GETC$(C$))=труе тхен0190       N:=орд(C$)-орд("а")+10200       иф GETC$(C$)<>цхр$(92) тхен0210         фор N:=N то 1 степ -1 до PUTC(C$)ф 1, CCL$ оф 10140   дим CCLEND$ оф 1, NEGATE$ оф 1, NCCL$ оф 1, LITCHAR$ оф 10150   MAXPAT:=1500160   CLOSIZE:=10170   CLOSURE$:=цхр$(42)0180   BOL$:=цхр$(37)0190   EOL$:=цхр$(36)0200   ANY$:=цхр$(63)0210   CCL$:=цхр$(91)0220   CCLEND$:=цхр$(93  PATTERN ELEMENT AT PAT(J)1060 //1070 фунц OMATCH(LIN$,реф I,PAT$,J) цлосед1080   импорт ERROR,LOCATE1090   импорт LITCHAR$,BOL$,EOL$,ANY$,CCL$,NCCL$,CLOSURE$1100   ADVANCE:=-11110   иф LIN$(I)=""0"" тхен ретурн фалсе1120   цасе PAT$(J) оф1130   N")0290   вхиле GETLINE(LIN$,5,150)=труе до0300     иф MATCH(LIN$,PAT$)=труе тхен PUTSTR(LIN$,6)0310   ендвхиле 0320 ендпроц FIND0330 //0340 //MATCH-FIND MATCH ANYWHERE ON LINE0350 //0360 фунц MATCH(LIN$,PAT$) цлосед0370   импорт AMATCH0380   PK>0 тхен //MATCHED REST OF PATTERN0690           DONE:=труе0700         елсе 0710           I:-10720         ендиф 0730       ендвхиле 0740       OFFSET:=K //IF K=0 THEN FAILURE ELSE SUCCESS0750       DONE:=труе0760     елиф OMATCH(LIN$,OFFSET,PA(OFFSET)...0490 //0500 фунц AMATCH(LIN$,OFFSET,PAT$,J) цлосед0510   импорт PATSIZE,OMATCH0520   импорт CLOSURE$0530   DONE:=фалсе0540   вхиле DONE=фалсе анд PAT$(J)<>""0"" до0550     иф PAT$(J)=CLOSURE$ тхен0560       J:+PATSIZE(PAT$,J) //STEP OVIZE-RETURNS SIZE OF PATTERN ENTRY AT PAT(J)0870 //0880 фунц PATSIZE(PAT$,N) цлосед0890   импорт ERROR0900   импорт LITCHAR$,BOL$,EOL$,ANY$,CCL$,NCCL$,CLOSURE$,CLOSIZE0910   цасе PAT$(N) оф0920   вхен LITCHAR$0930     ретурн 20940   вхен BOL$,EOL$0010 PROG$:="ецхо"0020 //0030 //ECHO-ECHO COMMAND LINE ARGS0040 //0050 INIT //INITIALISE0060 ECHO0070 FINIT //FINALISE0080 енд 0090 //0100 //ECHO-ECHO COMMAND LINE ARGS0110 //0120 проц ECHO 0130   дим ARGSTR$ оф 1500140   I:=10150   вхиле G0010 PROG$:="еьпанд"0020 //0030 //EXPAND-UNCOMPRESS INPUT0040 //0050 INIT //INITIALISE0060 EXPAND0070 FINIT //FINALISE0080 енд 0090 //0100 //EXPAND-UNCOMPRESS INPUT0110 //0120 проц EXPAND 0130   дим C$ оф 1, WARNING$ оф 10140   WARNING$:=цхр0010 PROG$:="финд"0020 //0030 //FIND-FIND PATTERNS IN TEXT0040 //0050 INIT //INITIALISE0060 FIND0070 FINIT //FINALISE0080 енд 0090 //0100 //FIND-FIND PATTERNS IN TEXT0110 //0120 проц FIND 0130   дим CLOSURE$ оф 1, BOL$ оф 1, EOL$ оф 1, ANY$ о М0220       елсе 0230         PUTC(WARNING$)0240         PUTC(цхр$(N-1+орд("а")))0250       ендиф 0260     елсе 0270       PUTC(WARNING$)0280       иф C$<>цхр$(92) тхен PUTC(C$)0290     ендиф 0300   ендвхиле 0310 ендпроц EXPAND)0230   NEGATE$:=цхр$(94)0240   NCCL$:=цхр$(33)0250   LITCHAR$:=цхр$(67)0260   дим ARG$ оф 150, LIN$ оф 150, PAT$ оф 1500270   иф GETARG(1,ARG$,150)=фалсе тхен ERROR("USAGE: FIND PATTERN")0280   иф GETPAT(ARG$,PAT$)=фалсе тхен ERROR("ILLEGAL PATTERS FAIL0630       //MATCH REST OF PATTERN AGAINST REST OF INPUT0640       //SHRINK CLOSURE BY 1 AFTER EACH FAILURE0650       DONE:=фалсе0660       вхиле DONE=фалсе анд I>=OFFSET до0670         K:=AMATCH(LIN$,I,PAT$,J+PATSIZE(PAT$,J))0680         иф OS:=00390   I:=10400   вхиле LIN$(I)<>""0"" анд POS=0 до0410     POS:=AMATCH(LIN$,I,PAT$,1)0420     I:+10430   ендвхиле 0440   иф POS>0 тхен ретурн труе0450   ретурн фалсе0460 ендфунц MATCH0470 //0480 //AMATCH-LOOK FOR MATCH AT PAT(J)... AT LIN	T$,J)=фалсе тхен0770       OFFSET:=0 //NON-CLOSURE0780       DONE:=труе0790     елсе //OMATCH SUCCEEDED ON THIS PATTERN ELEMENT0800       J:+PATSIZE(PAT$,J)0810     ендиф 0820   ендвхиле 0830   ретурн OFFSET0840 ендфунц AMATCH0850 //0860 //PATSER CLOSURE0570       I:=OFFSET0580       //MATCH AS MANY AS POSSIBLE0590       вхиле DONE=фалсе анд LIN$(I)<>""0"" до0600         иф OMATCH(LIN$,I,PAT$,J)=фалсе тхен DONE:=труе0610       ендвхиле 0620       //I POINTS TO INPUT CHARACTER THAT MADE U
вхен LITCHAR$1140     иф LIN$(I)=PAT$(J+1) тхен ADVANCE:=11150   вхен BOL$1160     иф I=1 тхен ADVANCE:=01170   вхен ANY$1180     иф LIN$(I)<>""13"" тхен ADVANCE:=11190   вхен EOL$1200     иф LIN$(I)=""13"" тхен ADVANCE:=01210   вхен CCL$1220    с(K),DEST$,J,MAXSET)2610         ендфор K2620       ендиф 2630       I:+12640     елсе 2650       JUNK:=ADDSTR("-",DEST$,J,MAXSET)2660     ендиф 2670     I:+12680   ендвхиле 2690 ендпроц DODASH2700 //1300   иф ADVANCE>=0 тхен1310     I:+ADVANCE1320     ретурн труе1330   елсе 1340     ретурн фалсе1350   ендиф 1360 ендфунц OMATCH1370 //1380 //LOCATE-LOOK FOR C IN CHARACTER CLASS AT PAT(OFFSET)1390 //1400 фунц LOCATE(C$,PAT$,OFFSET) цлосед14 елсе //ALL IS WELL2090     ретурн I2100   ендиф 2110 ендфунц MAKEPAT2120 //2130 //GETCCL-EXPAND CHAR CLASS AT ARG(I) INTO PAT(J)2140 //2150 фунц GETCCL(ARG$,реф I,реф PAT$,реф J) цлосед2160   импорт DODASH,ADDSTR2170   импорт NEGATE$,NCCL$,CCL$ елсе 1490       I:-11500     ендиф 1510   ендвхиле 1520   ретурн LOC1530 ендфунц LOCATE1540 //1550 //GETPAT-CONVERT ARGUMENT INTO PATTERN1560 //1570 фунц GETPAT(ARG$,реф PAT$) цлосед1580   импорт MAKEPAT1590   иф MAKEPAT(ARG$,1,""0"",PAT$)>0 XPAT) //ROOM FOR COUNT2270   DODASH(CCLEND$,ARG$,I,PAT$,J,MAXPAT)2280   PAT$(JSTART):=цхр$(J-JSTART-1)2290   иф ARG$(I)=CCLEND$ тхен ретурн труе2300   ретурн фалсе2310 ендфунц GETCCL2320 //2330 //STCLOSE-INSERT CLOSURE ENTRY AT PAT(J)2340 //2350,BOL$,EOL$,CCL$,CLOSURE$,LITCHAR$1680   J:=1 //PAT$ INDEX1690   I:=START //ARG$ INDEX1700   LASTJ:=11710   DONE:=фалсе1720   вхиле DONE=фалсе анд ARG$(I)<>DELIM$ анд ARG$(I)<>""0"" до1730     LJ:=J1740     цасе ARG$(I) оф1750     вхен ANY$1760  PAT$(LASTJ):=CLOSURE$ //WHERE ORIGINAL PATTERN BEGAN2440 ендпроц STCLOSE2450 //2460 //DODASH-EXPAND SET AT SRC(I) INTO DEST(J), STOP AT DELIM2470 //2480 проц DODASH(DELIM$,SRC$,реф I,реф DEST$,реф J,MAXSET) цлосед2490   импорт ADDSTR,META$,ISALPHANT$,J)=фалсе тхен1830         DONE:=труе1840       елсе 1850         DONE:=фалсе1860       ендиф 1870     вхен CLOSURE$1880       иф I>START тхен1890         LJ:=LASTJ1900         цасе PAT$(LJ) оф1910         вхен BOL$,EOL$,CLOSURE$1920         ""0"" тхен2560       JUNK:=ADDSTR("-",DEST$,J,MAXSET)2570     елиф (ISALPHANUM(SRC$(I-1)) анд ISALPHANUM(SRC$(I+1))) тхен2580       иф SRC$(I-1)<=SRC$(I+1) тхен2590         фор K:=орд(SRC$(I-1))+1 то орд(SRC$(I+1)) до2600           JUNK:=ADDSTR(цхр$  иф LOCATE(LIN$(I),PAT$,J+1)=труе тхен ADVANCE:=11230   вхен NCCL$1240     иф LIN$(I)<>""13"" тхен1250       иф LOCATE(LIN$(I),PAT$,J+1)=фалсе тхен ADVANCE:=11260     ендиф 1270   отхервисе 1280     ERROR("IN OMATCH: CAN'T HAPPEN")1290   ендцасе XPAT)2000     ендцасе 2010     LASTJ:=LJ2020     иф DONE=фалсе тхен I:+12030   ендвхиле 2040   иф DONE=труе ор ARG$(I)<>DELIM$ тхен //FINISHED EARLY2050     ретурн 02060   елиф ADDSTR(""0"",PAT$,J,150)=фалсе тхен //NO ROOM2070     ретурн 02080  10   //SIZE OF CLASS IS AT PAT(OFFSET),CHARACTERS FOLLOW1420   LOC:=фалсе1430   I:=OFFSET+орд(PAT$(OFFSET)) //LAST POSITION1440   вхиле I>OFFSET до1450     иф C$=PAT$(I) тхен1460       LOC:=труе1470       I:=OFFSET //FORCE LOOP TERMINATION1480    ,CCLEND$,MAXPAT2180   I:+1 //SKIP OVER LBRACK2190   иф ARG$(I)=NEGATE$ тхен2200     JUNK:=ADDSTR(NCCL$,PAT$,J,MAXPAT)2210     I:+12220   елсе 2230     JUNK:=ADDSTR(CCL$,PAT$,J,MAXPAT)2240   ендиф 2250   JSTART:=J2260   JUNK:=ADDSTR("0",PAT$,J,MAтхен ретурн труе1600   ретурн фалсе1610 ендфунц GETPAT1620 //1630 //MAKEPAT-MAKE PATTERNS FROM ARG(I), TERMINATE AT DELIM1640 //1650 фунц MAKEPAT(ARG$,START,DELIM$,реф PAT$) цлосед1660   импорт ADDSTR,GETCCL,STCLOSE,META$1670   импорт ANY$,MAXPAT проц STCLOSE(реф PAT$,реф J,LASTJ) цлосед2360   импорт ADDSTR2370   импорт CLOSIZE,MAXPAT,CLOSURE$2380   фор JP:=J-1 то LASTJ степ -1 до2390     JT:=JP+CLOSIZE2400     JUNK:=ADDSTR(PAT$(JP),PAT$,JT,MAXPAT)2410   ендфор JP2420   J:+CLOSIZE2430        JUNK:=ADDSTR(ANY$,PAT$,J,MAXPAT)1770     вхен BOL$1780       иф I=START тхен JUNK:=ADDSTR(BOL$,PAT$,J,MAXPAT)1790     вхен EOL$1800       иф ARG$(I+1)=DELIM$ тхен JUNK:=ADDSTR(EOL$,PAT$,J,MAXPAT)1810     вхен CCL$1820       иф GETCCL(ARG$,I,PA	UM2500   вхиле SRC$(I)<>DELIM$ анд SRC$(I)<>""0"" до2510     иф SRC$(I)=цхр$(64) тхен2520       JUNK:=ADDSTR(META$(SRC$,I),DEST$,J,MAXSET)2530     елиф SRC$(I)<>"-" тхен2540       JUNK:=ADDSTR(SRC$(I),DEST$,J,MAXSET)2550     елиф J<=1 ор SRC$(I+1)=  DONE:=труе //FORCE LOOP TERMINATION1930         отхервисе 1940           STCLOSE(PAT$,J,LASTJ)1950         ендцасе 1960       ендиф 1970     отхервисе 1980       JUNK:=ADDSTR(LITCHAR$,PAT$,J,MAXPAT)1990       JUNK:=ADDSTR(META$(ARG$,I),PAT$,J,MA
0010 PROG$:="инцлуде"0020 //0030 //INCLUDE-REPLACE #INCLUDE FILE BY CONTENTS OF FILE0040 //0050 INIT //INITIALISE0060 INCLUDE0070 FINIT //FINALISE0080 енд 0090 //0100 //INCLUDE - REPLACE #INCLUDE FILE BY CONTENTS OF FILE0110 //0120 проц INCLUD HASHSIZE:=53 //SIZE OF HASH TBLE0211   NEXTTAB:=00220   дим DEFTYPE$ оф 1, MACTYPE$ оф 1, IFTYPE$ оф 1, SUBTYPE$ оф 10230   дим EXPRTYPE$ оф 1, LENTYPE$ оф 1, CHQTYPE$ оф 10240   NDPTR:=00250   дим P'NAME(1:HASHSIZE), P'DEFN(1:HASHSIZE), P'KIND$(1:импорт INCL$0230   дим LINE$ оф 150, S$ оф 1500240   вхиле GETLINE(LINE$,F,150)=труе до0250     LOC:=GETWORD(LINE$,1,S$)0260     иф нот EQUAL(S$,INCL$) тхен0270       PUTSTR(LINE$,6)0280     елсе 0290       LOC:=GETWORD(LINE$,LOC,S$)0300       F1р$(36)0150   дим BUF$ оф 1500160   вхиле GETLINE(BUF$,5,150)=труе до PUTROT(BUF$)0170 ендпроц KWIC0180 //0190 //PUTROT-CREATE LINES WITH KEYWORD AT FRONT0200 //0210 проц PUTROT(BUF$) цлосед0220   импорт ISALPHANUM0230   I:=10240   вхиле BUF$(I)I:I)=" " ор S$(I:I)=цхр$(13) до I:+10420   OUT$:=""0430   C$:=S$(I:I)0440   вхиле нот (C$=цхр$(0) ор C$=" " ор C$=цхр$(13)) до0450     OUT$:+C$0460     I:+10470     C$:=S$(I:I)0480   ендвхиле 0490   OUT$:+цхр$(0)0500   иф S$(I:I)=цхр$(0) тхен ре/0340   //ROTATE-OUTPUT ROTATED LINE0350   //0360   проц ROTATE(BUF$,N) цлосед0370     импорт PUTC,FOLD$0380     I:=N0390     вхиле BUF$(I)<>""13"" анд BUF$(I)<>""0"" до0400       PUTC(BUF$(I))0410       I:+10420     ендвхиле 0430     PUTC(FOLDZE)0340   дим EVALSTK$ оф MAXCHARS0350   дим DEFNAME$ оф 7, EXPRNAME$ оф 5, SUBNAME$ оф 7, IFNAME$ оф 70360   дим LENNAME$ оф 7, HQNAME$ оф 8, NUL$ оф 1, LQUOTE$ оф 1, RQUOTE$ оф 10370   DEFTYPE$:=цхр$(200)0380   MACTYPE$:=цхр$(201)0390   IFTYPE$:= цхр$(202)0400   SUBTYPE$:=цхр$(203)0410   EXPRTYPE$:=цхр$(204)0420   LENTYPE$:=цхр$(205)0430   CHQTYPE$:=цхр$(206)0440   NUL$:=цхр$(0)0450   DEFNAME$:="DEFINE"+цхр$(0)0460   SUBNAME$:="SUBSTR"+цхр$(0)0470   EXPRNAME$:="EXPR"+цхр$(0)0480   IFNAME ÷0150   вхиле GETC$(C$)<>цхр$(92) до0160     иф C$=""13"" тхен NL:+10170   ендвхиле 0180   PUTDEC(NL,1)0190   PUTC(""13"")0200 ендпроц LINECOUNT0210 //BUFFER0140   MAXCHARS:=1000 //SIZE OF NAME-DEFN TABLE0150   MAXPOS:=100 //SIZE OF POSITION ARRAYS0160   CALLSIZE:=MAXPOS0170   ARGSIZE:=MAXPOS0180   EVALSIZE:=MAXCHARS0190   MAXDEF:=150 //CHARS IN A DEFN0200   MAXTOK:=150 //CHARS IN A TOKEN0210  E 0130   дим INCL$ оф 90140   INCL$:="#INCLUDE"+цхр$(0)0150   FINCLUDE(5)0160 ендпроц INCLUDE0170 //0180 //FINCLUDE - INCLUDE FILE DESC F0190 //0200 проц FINCLUDE(F) цлосед0210   импорт GETWORD,GETLINE,EQUAL,PUTSTR,LENGTH,MUSTOPEN,XCLOSE0220   0010 PROG$:="квиц"0020 //0030 //KWIC-MAKE KEYWORD IN CONTEXT INDEX0040 //0050 INIT //INITIALISE0060 KWIC0070 FINIT //FINALISE0080 енд 0090 //0100 //KWIC-MAKE KEYWORD IN CONTEXT INDEX0110 //0120 проц KWIC 0130   дим FOLD$ оф 10140   FOLD$:=цх:=MUSTOPEN(S$,0)0310       FINCLUDE(F1)0320       XCLOSE(F1)0330     ендиф 0340   ендвхиле 0350 ендпроц FINCLUDE0360 //0370 //GETWORD - GET WORD FROM S$(I) TO OUT$0380 //0390 фунц GETWORD(S$,I,реф OUT$) цлосед0400   дим C$ оф 10410   вхиле S$(<>""13"" анд BUF$(I)<>""0"" до0250     иф ISALPHANUM(BUF$(I))=труе тхен0260       ROTATE(BUF$,I) //TOKEN STARTS AT I0270       репеат 0280         I:+10290       унтил ISALPHANUM(BUF$(I))=фалсе0300     ендиф 0310     I:+10320   ендвхиле 0330   / .турн 00510   ретурн I0520 ендфунц 0530 // ─$)0440     фор I:=1 то N-1 до PUTC(BUF$(I))0450     PUTC(""13"")0460   ендпроц ROTATE0470   //0480 ендпроц PUTROT0490 //0010 PROG$:="линецоунт"0020 //0030 //LINECOUNT-COUNT LINES ON INPUT0040 //0050 INIT //INITIALISE0060 LINECOUNT0070 FINIT //FINALISE0080 енд 0090 //0100 //LINECOUNT-COUNT LINES ON INPUT0110 //0120 проц LINECOUNT 0130   дим C$ оф 10140   NL:=0	0010 PROG$:="мацро"0020 //0030 //EXPAND MACROS WITH ARGUMENTS0040 //0050 INIT //INITIALISE0060 MACRO0070 FINIT //FINALISE0080 енд 0090 //0100 //MACRO - EXPAND MACROS WITH ARGUMENTS0110 //0120 проц MACRO 0130   BUFSIZE:=500 //SIZE OF PUSHBACK HASHSIZE) оф 10260   дим P'NEXTPTR(1:HASHSIZE)0270   дим BUF$ оф BUFSIZE0280   BP:=00290   дим HASHTAB(1:HASHSIZE)0300   дим NDTABLE$ оф MAXCHARS0310   дим CALLSTK(1:MAXPOS), ARGSTK(1:MAXPOS)0320   дим TYPESTK$ оф CALLSIZE0330   дим PLEV(1:CALLSI
$:="IFELSE"+цхр$(0)0490   LENNAME$:="STRLEN"+цхр$(0)0500   CHQNAME$:="CHANGEQ"+цхр$(0)0510   BP:=00520   LQUOTE$:="!"0530   RQUOTE$:="#"0540   INITHASH0550   INSTALL(DEFNAME$,NUL$,DEFTYPE$)0560   INSTALL(EXPRNAME$,NUL$,EXPRTYPE$)0570   INSTALL(S ндиф 1970         K:-1 //SKIP OVER $1980       ендиф 1990       K:-12000     ендвхиле 2010     иф K=T тхен //DO LAST CHARACTER2020       PUTBACK(EVALSTK$(K:K))2030     ендиф 2040   ендцасе 2050 ендпроц EVAL2060 //2070 //DODEF - INSTALL DEFINITETTOK$(TOKEN$,MAXTOK)<>цхр$(92) до0660     иф ISLETTER(TOKEN$(1:1))=труе тхен0670       иф LOOKUP(TOKEN$,DEFN$,TOKTYPE$)=фалсе тхен0680         PUTTOK(TOKEN$)0690       елсе //DEFINED, PUT IN EVAL STACK0700         CP:+10710         иф CP>CALLSIZE S$(I:I))1350     I:+11360   ендвхиле 1370 ендпроц PUTTOK1380 //1390 //PUTCHR - PUT SINGLE CHAR ON OUTPUT OR EVALUATION STACK1400 //1410 проц PUTCHR(C$) цлосед1420   импорт PUTC,ERROR1430   импорт EVALSTK$,EVALSIZE,CP,EP1440   иф CP<=0 тхен1450,AP)0780         PUTTOK(TOKEN$) //STACK NAME0790         PUTCHR(цхр$(0))0800         AP:=PUSH(EP,ARGSTK(),AP)0810         T$:=GETTOK$(TOKEN$,MAXTOK) //PEEK AT NEXT0820         PBSTR(TOKEN$)0830         иф T$<>"(" тхен //ADD ()0840           PUTBACнц PUSH(EP,реф ARGSTK(),AP) цлосед1560   импорт ERROR1570   импорт ARGSIZE1580   иф AP>ARGSIZE тхен ERROR("MACRO:ARGUMENT STACK OVERFLOW.")1590   ARGSTK(AP):=EP1600   ретурн AP+11610 ендфунц PUSH1620 //1630 //EVAL - EXPAND ARGS I..J: DO BUILT-IN TE$ тхен0940           NLPAR:-10950         елиф T$=LQUOTE$ тхен0960           NLPAR:+10970         елиф T$=цхр$(92) тхен0980           ERROR("MACRO:MISSING RIGHT QUOTE.")0990         ендиф 1000         иф NLPAR>0 тхен PUTTOK(TOKEN$)1010       ун01700   T:=ARGSTK(I)1710   цасе TD$ оф1720   вхен DEFTYPE$1730     DODEF(ARGSTK(),I,J)1740   вхен EXPRTYPE$1750     DOEXPR(ARGSTK(),I,J)1760   вхен SUBTYPE$1770     DOSUB(ARGSTK(),I,J)1780   вхен IFTYPE$1790     DOIF(ARGSTK(),I,J)1800   вхен LPLEV(CP)>0 тхен1100         PUTTOK(TOKEN$)1110       елсе //END OF ARGUMENT LIST1120         PUTCHR(цхр$(0))1130         EVAL(ARGSTK(),TYPESTK$(CP:CP),CALLSTK(CP),AP-1)1140         AP:=CALLSTK(CP) //POP EVAL STACK1150         EP:=ARGSTK(AP)1160   >"$" тхен1900         PUTBACK(EVALSTK$(K:K))1910       елсе 1920         ARGNO:=орд(EVALSTK$(K:K))-орд("0")1930         иф ARGNO>=0 анд ARGNO<=J-I тхен1940           CSCOPY(EVALSTK$,ARGSTK(I+ARGNO+1),TEMP$)1950           PBSTR(TEMP$)1960         еUBNAME$,NUL$,SUBTYPE$)0580   INSTALL(IFNAME$,NUL$,IFTYPE$)0590   INSTALL(LENNAME$,NUL$,LENTYPE$)0600   INSTALL(CHQNAME$,NUL$,CHQTYPE$)0610   CP:=00620   AP:=10630   EP:=10640   дим DEFN$ оф 150, TOKEN$ оф 150, TOKTYPE$ оф 1, T$ оф 10650   вхиле Gф CP<>0 тхен ERROR("MACRO:UNEXPECTED EON OF INPUT.")1260 ендпроц MACRO1270 //1280 //PUTTOK - PUT TOKEN ON OUTPUT OR EVALUATION STACK1290 //1300 проц PUTTOK(S$) цлосед1310   импорт PUTCHR1320   I:=11330   вхиле S$(I:I)<>цхр$(0) до1340     PUTCHR(тхен ERROR("MACRO:CALL STACK OVERFLOW.")0720         CALLSTK(CP):=AP0730         TYPESTK$(CP:CP):=TOKTYPE$0740         AP:=PUSH(EP,ARGSTK(),AP)0750         PUTTOK(DEFN$) //PUSH DEFINITION0760         PUTCHR(цхр$(0))0770         AP:=PUSH(EP,ARGSTK()     PUTC(C$)1460   елсе 1470     иф EP>EVALSIZE тхен ERROR("MACRO:EVALUATION STACK OVERFLOW.")1480     EVALSTK$(EP:EP):=C$1490     EP:+11500   ендиф 1510 ендпроц PUTCHR1520 //1530 //PUSH-PUSH EP ONTO ARGSTK,RETURN NEW POSITION AP1540 //1550 фуK(")")0850           PUTBACK("(")0860         ендиф 0870         PLEV(CP):=00880       ендиф 0890     елиф TOKEN$(1:1)=LQUOTE$ тхен //STRIP QUOTES0900       NLPAR:=10910       репеат 0920         T$:=GETTOK$(TOKEN$,MAXTOK)0930         иф T$=RQUOOR PUSH BACK DEFN1640 //1650 проц EVAL(реф ARGSTK(),TD$,I,J) цлосед1660   импорт DODEF,PUTBACK,CSCOPY,PBSTR,DOEXPR,DOSUB,DOIF,DOLEN,DOCHQ1670   импорт DEFTYPE$,EXPRTYPE$,SUBTYPE$,IFTYPE$,LENTYPE$,CHQTYPE$1680   импорт EVALSTK$1690   дим TEMP$ оф 15тил NLPAR=01020     елиф CP=0 тхен //NOT IN A MACRO1030       PUTTOK(TOKEN$)1040     елиф TOKEN$(1:1)="(" тхен1050       иф PLEV(CP)>0 тхен PUTTOK(TOKEN$)1060       PLEV(CP):+11070     елиф TOKEN$(1:1)=")" тхен1080       PLEV(CP):-11090       иф 	ENTYPE$1810     DOLEN(ARGSTK(),I,J)1820   вхен CHQTYPE$1830     DOCHQ(ARGSTK$(),I,J)1840   отхервисе 1850     K:=T1860     вхиле EVALSTK$(K:K)<>цхр$(0) до K:+11870     K:-1 //LAST CHAR OF DEFN1880     вхиле K>T до1890       иф EVALSTK$(K-1:K-1)<      CP:-11170       ендиф 1180     елиф TOKEN$(1)="," анд PLEV(CP)=1 тхен1190       PUTCHR(цхр$(0)) //NEW ARGUMENT1200       AP:=PUSH(EP,ARGSTK(),AP)1210     елсе 1220       PUTTOK(TOKEN$) //JUST STACK IT1230     ендиф 1240   ендвхиле 1250   и
ION IN TABLE2080 //2090 проц DODEF(реф ARGSTK(),I,J) цлосед2100   импорт CSCOPY,INSTALL2110   импорт MACTYPE$,EVALSTK$2120   дим TEMP1$ оф 150, TEMP2$ оф 1502130   иф J-I>2 тхен2140     CSCOPY(EVALSTK$,ARGSTK(I+2),TEMP1$)2150     CSCOPY(EVALSTK$,3180   TEMP$:=стр$(N)+цхр$(0)3190   PBSTR(TEMP$)3200 ендпроц PBNUM3210 //3220 //EXPR - RECURSIVE EXPRESSION EVAUATION3230 //3240 фунц EXPR(S$,реф I) цлосед3250   импорт GNBCHAR$,TERM3260   дим T$ оф 13270   V:=TERM(S$,I)3280   T$:=GNBCHAR$(S$,I J-I>=3 тхен2720     иф J-I<4 тхен2730       NC:=MAXTOK2740     елсе 2750       CSCOPY(EVALSTK$,ARGSTK(I+4),TEMP1$)2760       K:=12770       NC:=EXPR(TEMP1$,K)2780     ендиф 2790     CSCOPY(EVALSTK$,ARGSTK(I+3),TEMP1$) //ORIGIN2800     AP:=ARGST дим TEMP1$ оф 150, TEMP2$ оф 150, TEMP3$ оф 1502260   иф J-I>4 тхен2270     CSCOPY(EVALSTK$,ARGSTK(I+2),TEMP1$)2280     CSCOPY(EVALSTK$,ARGSTK(I+3),TEMP2$)2290     иф EQUAL(TEMP1$,TEMP2$) тхен2300       CSCOPY(EVALSTK$,ARGSTK(I+4),TEMP3$)2310     RM - EVALUATE TERM OF AN EXPRESSION3420 //3430 фунц TERM(S$,реф I) цлосед3440   импорт FACTOR,GNBCHAR$3450   дим T$ оф 13460   V:=FACTOR(S$,I)3470   T$:=GNBCHAR$(S$,I)3480   вхиле T$="*" ор T$="/" ор T$="%" до3490     I:+13500     цасе T$ оф351 FC степ -1 до2870         PUTBACK(EVALSTK$(K:K))2880       ендфор K2890     ендиф 2900   ендиф 2910 ендпроц DOSUB2920 //2930 //DOCHQ - CHANGE QUOTE CHARSS2940 //2950 проц DOCHQ(реф ARGSTK(),I,J) цлосед2960   импорт CSCOPY,LENGTH2970   импорт XPR(реф ARGSTK(),I,J) цлосед2430   импорт CSCOPY,PBNUM2440   импорт EVALSTK$2450   дим TEMP$ оф 1502460   CSCOPY(EVALSTK$,ARHSTK(I+2),TEMP$)2470   JUNK:=12480   PBNUM(EXPR(TEMP$,JUNK))2490 ендпроц DOEXPR2500 //2510 //DOLEN - RETURN LENGTH OF ARG0 //FACTOR - EVALUATE FACTOR OF EXPRESSION3640 //3650 фунц FACTOR(S$,реф I) цлосед3660   импорт GNBCHAR$,MESSAGE,EXPR,CTOI3670   иф GNBCHAR$(S$,I)="(" тхен3680     I:+13690     RES:=EXPR(S$,I)3700     иф GNBCHAR$(S$,I)=")" тхен3710       I:+13723070   елсе 3080     LQUOTE$:=TEMP$(1:1)3090     RQUOTE$:=TEMP$(2:2)3100   ендиф 3110 ендпроц DOCHQ3120 //3130 //PBNUM - CONVERT NUMBER TO STRING, PUSH BACK ONTO INPUT3140 //3150 проц PBNUM(N) цлосед3160   импорт PUTSTR3170   дим TEMP$ оф 150BNUM(0)2620   ендиф 2630 ендпроц DOLEN2640 //2650 //DOSUB - SELECT SUBSTRING2660 //2670 проц DOSUB(реф ARGSTK(),I,J) цлосед2680   импорт CSCOPY,EXPR,LENGTH,PUTBACK,MIN2690   импорт EVALSTK$,MAXTOK2700   дим TEMP1$ оф 150, TEMP2$ оф 1502710   ифARGSTK(I+3),TEMP2$)2160     INSTALL(TEMP1$,TEMP2$,MACTYPE$)2170   ендиф 2180 ендпроц DODEF2190 //2200 //DOIF - SELECT ONE OF TWO ARGUMENTS2210 //2220 проц DOIF(реф ARGSTK(),I,J) цлосед2230   импорт CSCOPY,EQUAL,PBSTR2240   импорт EVALSTK$2250  )3290   вхиле T$="+" ор T$="-" до3300     I:+13310     иф T$="+" тхен3320       V:=V+TERM(S$,I)3330     елсе 3340       V:=V-TERM(S$,I)3350     ендиф 3360     T$:=GNBCHAR$(S$,I)3370   ендвхиле 3380   ретурн V3390 ендфунц EXPR3400 //3410 //TEK(I+2) //TARGET STRING2810     K:=12820     FC:=AP+EXPR(TEMP1$,K)-1 //FIRST CHAR2830     CSCOPY(EVALSTK$,AP,TEMP2$)2840     иф FC>=AP анд FC<AP+LENGTH(TEMP2$) тхен2850       CSCOPY(EVALSTK$,FC,TEMP1$)2860       фор K:=FC+MIN(NC,LENGTH(TEMP1$))-1 тоелиф J-I>=5 тхен2320       CSCOPY(EVALSTK$,ARGSTK(I+5),TEMP3$)2330     елсе 2340       TEMP3$:=цхр$(0)2350     ендиф 2360     PBSTR(TEMP3$)2370   ендиф 2380 ендпроц DOIF2390 //2400 //DOEXPR - EVALUATE ARITHMETIC EXPRESSIONS2410 //2420 проц DOE0     вхен "*"3520       V:=V*FACTOR(S$,I)3530     вхен "/"3540       V:=V диж FACTOR(S$,I)3550     вхен "%"3560       V:=V мод FACTOR(S$,I)3570     ендцасе 3580     T$:=GNBCHAR$(S$,I)3590   ендвхиле 3600   ретурн V3610 ендфунц TERM3620 //363EVALSTK$,LQUOTE$,RQUOTE$2980   дим TEMP$ оф 1502990   CSCOPY(EVALSTK$,ARGSTK(I+2),TEMP$)3000   N:=LENGTH(TEMP$)3010   иф N<=0 тхен3020     LQUOTE$:="!"3030     RQUOTE$:="#"3040   елиф N=1 тхен3050     LQUOTE$:=TEMP$(1:1)3060     RQUOTE$:=LQUOTE$	UMENT2520 //2530 проц DOLEN(реф ARGSTK(),I,J) цлосед2540   импорт CSCOPY,PBNUM,LENGTH2550   импорт EVALSTK$2560   дим TEMP$ оф 1502570   иф J-I>1 тхен2580     CSCOPY(EVALSTK$,ARGSTK(I+2),TEMP$)2590     PBNUM(LENGTH(TEMP$))2600   елсе 2610     P 0     елсе 3730       MESSAGE("MACRO:MISSING PAREN IN EXPR")3740     ендиф 3750   елсе 3760     RES:=CTOI(S$,I)3770   ендиф 3780   ретурн RES3790 ендфунц FACTOR3800 //3810 //GNBCHAR$ - GET NEXT NON-BLANK CHAR3820 //3830 фунц GNBCHAR$(S$,реф I)
 цлосед3840   вхиле S$(I:I)=" " ор S$(I:I)=""13"" до I:+13850   ретурн S$(I:I)3860 ендфунц GNBCHAR$3870 //3880 //GETTOK - GET TOKEN FOR DEFINE3890 //3900 фунц GETTOK$(реф TOK$,TOKSIZE) цлосед3910   импорт ISALPHANUM,GETPBC$,ERROR,PUTBACK3920   /MPNAME$)4970     иф EQUAL(NAME$,TEMPNAME$)=труе тхен4980       FOUND:=труе4990     елсе 5000       P:=P'NEXTPTR(P)5010       //принт "P=",P5020     ендиф 5030   ендвхиле 5040   ретурн P5050 ендфунц HASHFIND5060 //5070 //HASH - COMPUTE HASH FUN INITIALISE HASH TABLE AND LINKED LIST ARRAYS4560 //4570 проц INITHASH цлосед4580   импорт HASHTAB(),NDPTR,P'NAME(),P'DEFN(),P'KIND$(),P'NEXTPTR(),HASHSIZE4590   импорт NDTABLE$,NEXTTAB4600   NEXTTAB:=1 //FIRST FREE SLOT IN HASHTABLE4610   NDPTR:=0     DONE:=труе4040     ендиф 4050   ендвхиле 4060   иф I>=TOKSIZE тхен4070     ERROR("TOKEN TOO LONG.")4080   ендиф 4090   иф I>1 тхен //SOME ALPHA WAS SEEN4100     PUTBACK(TOK$(I:I))4110     I:-14120   ендиф 4130   //ELSE SINGLE NON-ALPHA414(I:I))) мод HASHSIZE5180     //принт "H=",H5190   ендфор I5200   //принт "H=",H+15210   ретурн H+15220 ендфунц HASH5230 //5240 //INSTALL - ADD NAME,DEFINITION AND TYPE TO TABLE5250 //5260 проц INSTALL(NAME$,DEFN$,T$) цлосед5270   импорт LENGTH,LOCATE NAME, GET DEFN AND TYPE FROM TABLE4720 //4730 фунц LOOKUP(реф NAME$,реф DEFN$,реф T$) цлосед4740   импорт HASHFIND,CSCOPY4750   импорт NDTABLE$,P'DEFN(),P'KIND$()4760   //принт "LOOKUP"4770   P:=HASHFIND(NAME$)4780   //принт "P=",P4790   иBUFSIZE тхен ERROR("TOO MANY CHARACTERS PUSHED BACK.")4250   BP:+14260   BUF$(BP:BP):=C$4270   //принт "BP=",BP4280 ендпроц PUTBACK4290 //4300 //GETPBC$ - GET A (POSSIBLY PUSHED BACK) CHARACTER4310 //4320 фунц GETPBC$(реф C$) цлосед4330   импортFN$)+15340   //принт "DLEN=",DLEN5350   иф NEXTTAB+NLEN+DLEN>MAXCHARS тхен5360     PUTSTR(NAME$,7)5370     ERROR(": TOO MANY DEFINITIONS.")5380   елсе //PUT IT AT FRONT OF CHAIN5390     H:=HASH(NAME$)5400     //принт "H=",H5410     NDPTR:+15420 890   импорт HASHTAB(),NDTABLE$,P'NAME(),P'NEXTPTR()4900   //принт "HASHFIND"4910   дим TEMPNAME$ оф 1504920   FOUND:=фалсе4930   P:=HASHTAB(HASH(NAME$))4940   //принт "P=",P4950   вхиле FOUND=фалсе анд P<>0 до4960     CSCOPY(NDTABLE$,P'NAME(P),TE4450   ретурн C$4460 ендфунц GETPBC$4470 //4480 //PBSTR - PUSH STRING BACK ONTO INPUT4490 //4500 проц PBSTR(S$) цлосед4510   импорт LENGTH,PUTBACK4520   фор I:=LENGTH(S$) то 1 степ -1 до PUTBACK(S$(I))4530 ендпроц PBSTR4540 //4550 //INITHASH -/принт "GETTOK$"3930   дим C$ оф 13940   I:=13950   DONE:=фалсе3960   TOK$:=спц$(150)3970   вхиле DONE=фалсе анд I<=TOKSIZE до3980     C$:=GETPBC$(C$)3990     TOK$(I:I):=C$4000     иф ISALPHANUM(C$)=труе тхен4010       I:+14020     елсе 4030  CTION OF NAME5080 //5090 фунц HASH(NAME$) цлосед5100   импорт LENGTH,PUTSTR,PUTCF5110   импорт HASHSIZE5120   //принт "HASH"5130   //PUTSTR(NAME$,7)5140   //PUTCF(""13"",7)5150   H:=05160   фор I:=1 то LENGTH(NAME$) до5170     H:=(3*H+орд(NAME$ //CURRENT POINTER TO LINKED LIST ARRAY4620   фор I:=1 то HASHSIZE до4630     HASHTAB(I):=04640     P'NAME(I):=04650     P'DEFN(I):=04660     P'KIND$(I):=цхр$(0)4670     P'NEXTPTR(I):=04680   ендфор I4690 ендпроц INITHASH4700 //4710 //LOOKUP - 0   TOK$(I+1:I+1):=цхр$(0)4150   ретурн TOK$(1:1)4160 ендфунц GETTOK$4170 //4180 //PUTBACK - PUSH CHARACTER BACK ONTO INPUT4190 //4200 проц PUTBACK(C$) цлосед4210   импорт ERROR4220   импорт BUF$,BP,BUFSIZE4230   //принт "PUTBACK"4240   иф BP>=PUTSTR,ERROR,HASH,SCCOPY5280   импорт MAXCHARS,P'NAME(),P'DEFN(),P'KIND$(),P'NEXTPTR(),NDPTR,NEXTTAB5290   импорт NDTABLE$,HASHTAB()5300   //принт "INSTALL"5310   NLEN:=LENGTH(NAME$)+1 //1 FOR ENDSTR5320   //принт "NLEN=",NLEN5330   DLEN:=LENGTH(DEф P=0 тхен ретурн фалсе4800   CSCOPY(NDTABLE$,P'DEFN(P),DEFN$)4810   T$:=P'KIND$(P)4820   ретурн труе4830 ендфунц LOOKUP4840 //4850 //HASHFIND - FIND NAME IN HASH TABL     E4860 //4870 фунц HASHFIND(NAME$) цлосед4880   импорт HASH,CSCOPY,EQUAL4	 GETC$4340   импорт BUF$,BP4350   //принт "GETPBC$"4360   //принт "BP=",BP4370   иф BP>0 тхен4380     C$:=BUF$(BP:BP)4390   елсе 4400     BP:=14410     BUF$(BP:BP):=GETC$(C$)4420   ендиф 4430   иф C$<>цхр$(92) тхен BP:-14440   //принт "C$=",C$     //принт "NDPTR=",NDPTR5430     P:=NDPTR5440     //принт "P=",P5450     P'NEXTPTR(P):=HASHTAB(H)5460     //принт "P'NEXTPTR(P)=",HASHTAB(H)5470     HASHTAB(H):=P5480     //принт "HASHTAB(H)=",P5490     P'NAME(P):=NEXTTAB5500     //принт "P'NAM
E(P)=",NEXTTAB5510     SCCOPY(NAME$,NDTABLE$,NEXTTAB)5520     NEXTTAB:+NLEN5530     P'DEFN(P):=NEXTTAB5540     //принт "P'DEFN(P)=",NEXTTAB5550     SCCOPY(DEFN$,NDTABLE$,NEXTTAB)5560     NEXTTAB:+DLEN5570     //принт "NEXTTAB=",NEXTTAB5580     P'иле LOW<HIGH до //MERGE RUNS0320     LIM:=MIN(LOW+MERGEORDER-1,HIGH)0330     GOPEN(INFILE(),LOW,LIM)0340     HIGH:+10350     OUTFILE:=MAKEFILE(HIGH)0360     MERGE(INFILE(),LIM-LOW+1,OUTFILE)0370     XCLOSE(OUTFILE)0380     GREMOVE(INFILE(),LOW,LIM),NLINES,LINEBUF$,5)0240     QUICK(LINEPOS(),NLINES,LINEBUF$)0250     HIGH:+10260     OUTFILE:=MAKEFILE(HIGH)0270     PTEXT(LINEPOS(),NLINES,LINEBUF$,OUTFILE)0280     XCLOSE(OUTFILE)0290   унтил DONE=труе0291   цлосе филе 50300   LOW:=10310   вх0   CB$(I):=""0""5720 ендпроц SCCOPY5730 //5740 //CSCOPY-COPY CB(I)... TO STRING S5750 //5760 проц CSCOPY(CB$,I,реф S$) цлосед5770   S$:=""5780   J:=15790   вхиле CB$(I)<>""0"" до5800     S$:+CB$(I)5810     I:+15820     J:+15830   ендвхиле 5=1 то NARGS до0150     JUNK:=GETARG(I,NAME$,150)0160     FIN:=MUSTOPEN(NAME$,0)0170     FPRINT(NAME$,FIN)0180     XCLOSE(FIN)0190   ендфор I0200 ендпроц PRINTER0210 //0220 //FPRINT-PRINT FILE NAME FROM FIN0230 //0240 проц FPRINT(NAME$,FIN) цлос яENO) цлосед0640   импорт PUTSTR,PUTDEC,PUTC0650   дим PAG$ оф 90660   PAG$:=" - пAGE "0""0670   PUTSTR(NAME$,6)0680   PUTSTR(PAG$,6)0690   PUTDEC(PAGENO,1)0700   PUTC(""13"")0710 ендпроц HEAD0720 //)0390     LOW:+MERGEORDER0400   ендвхиле 0410   GNAME(HIGH,NAME$) //FINAL CLEANUP0420   OUTFILE:=XOPEN(NAME$,0)0430   FCOPY(OUTFILE,6)0440   XREMOVE(OUTFILE)0450 ендпроц SORT0460 //0470 //CMP-COMPARE LINEBUF(I) WITH LINEBUF(J)0480 //0490 фунц GIN1)0330   HEAD(NAME$,PAGENO)0340   SKIP(MARGIN2)0350   LINENO:=MARGIN1+MARGIN2+10360   вхиле GETLINE(LINE$,FIN,150)=труе до0370     иф LINENO=0 тхен0380       SKIP(MARGIN1)0390       PAGENO:+10400       HEAD(NAME$,PAGENO)0410       SKIP(MARGIN CMP(I,J,LINEBUF$) цлосед0491   //принт "CMP";I;J0500   вхиле LINEBUF$(I)=LINEBUF$(J) анд LINEBUF$(I)<>""0"" до0510     I:+10520     J:+10530   ендвхиле 0540   иф LINEBUF$(I)=LINEBUF$(J) тхен ретурн 00550   иф LINEBUF$(I)=""0"" тхен ретурн -1 //FIR0150   MERGEORDER:=20160   дим LINEBUF$ оф MAXCHARS0170   дим LINEPOS(MAXLINES)0180   дим INFILE(MERGEORDER)0190   дим NAME$ оф 1500191   LINEBUF$:=спц$(MAXCHARS)0210   HIGH:=00220   репеат //INITIAL FORMATION OF RUNS0230     DONE:=GTEXT(LINEPOS(KIND$(P):=T$5590   ендиф 5600 ендпроц INSTALL5610 //5620 //SCCOPY-COPY STRING S TO CB(I)...5630 //5640 проц SCCOPY(S$,реф CB$,I) цлосед5650   J:=15660   вхиле S$(J)<>""0"" до5670     CB$(I):=S$(J)5680     J:+15690     I:+15700   ендвхиле 5710010 PROG$:="принт"0020 //0030 //PRINT-PRINT FILES WITH HEADINGS0040 //0050 INIT //INITIALISE0060 PRINTER0070 FINIT //FINALISE0080 енд 0090 //0100 //PRINT-PRINT FILES WITH HEADINGS0110 //0120 проц PRINTER 0130   дим NAME$ оф 1500140   фор I:-LINENO)0520 ендпроц FPRINT0530 //0540 //SKIP-OUTPUT N BLANK LINES0550 //0560 проц SKIP(N) цлосед0570   импорт PUTC0580   фор I:=1 то N до PUTC(""13"")0590 ендпроц SKIP0600 //0610 //HEAD-PRINT TOP OF PAGE HEADER0620 //0630 проц HEAD(NAME$,PAG -840   S$:+""0""5850 ендпроц CSCOPY5860 //ед0250   импорт SKIP,HEAD,GETLINE,PUTSTR0260   MARGIN1:=2 //LINES BEFORE HEADER0270   MARGIN2:=2 //LINES AFTER HEADER0280   BOTTOM:=64 //LAST TEXT LINE0290   PAGELEN:=66 //PHYSICAL PAGE LENGTH0300   дим LINE$ оф 1500310   PAGENO:=10320   SKIP(MAR ┤0010 PROG$:="скел"0020 //0030 //SKEL-SKELETON PROGRAM0040 //0050 INIT //INITIALISE0060 YOUR'PROC0070 FINIT //FINALISE0080 енд 	0010 PROG$:="сорт"0020 //0030 //SORT-EXTERNAL SORT OF TEXT LINES0040 //0050 INIT //INITIALISE0060 SORT0070 FINIT //FINALISE0080 енд 0090 //0100 //SORT-EXTERNAL SORT OF TEXT LINES0110 //0120 проц SORT 0130   MAXCHARS:=10000140   MAXLINES:=252)0420       LINENO:=MARGIN1+MARGIN2+10430     ендиф 0440     PUTSTR(LINE$,6)0450     LINENO:+10460     иф LINENO>=BOTTOM тхен0470       SKIP(PAGELEN-LINENO)0480       LINENO:=00490     ендиф 0500   ендвхиле 0510   иф LINENO>0 тхен SKIP(PAGELEN
ST SHORTER0560   иф LINEBUF$(J)=""0"" тхен ретурн +1 //SECOND SHORTER0570   иф LINEBUF$(I)<LINEBUF$(J) тхен ретурн -10580   ретурн +10590 ендфунц CMP0600 //0610 //EXCHANGE-EXCHANGE LINEBUF(P1) WITH LINEBUF(P2)0620 //0630 проц EXCHANGE(реф LP1,реф0     GNAME(F1+I-1,NAME$)1570     INFILE(I):=MUSTOPEN(NAME$,0)1580   ендфор I1590 ендпроц GOPEN1600 //1610 //GREMOVE-REMOVE GROUP OF FILES F1..F21620 //1630 проц GREMOVE(реф INFILE(),F1,F2) цлосед1631   принт "GREMOVE";F1;F21640   импорт XREMOVE1140     иф LO<HI тхен1150       I:=LO1160       J:=HI1170       PIVLINE:=LINEPOS(J) //PIVOT LINE1180       репеат 1190         вхиле I<J анд CMP(LINEPOS(I),PIVLINE,LINEBUF$)<=0 до I:+11200         вхиле J>I анд CMP(LINEPOS(J),PIVLINE,LINEBUF$)>=0 инт "GTEXT"0720   импорт GETLINE,LENGTH,MAXCHARS,MAXLINES0730   дим TEMP$ оф 1500740   NLINES:=00750   NEXTPOS:=10760   репеат 0770     DONE:=фалсе0780     иф GETLINE(TEMP$,INFILE,150)=фалсе тхен DONE:=труе0790     иф DONE=фалсе тхен0800       N+11760   ендвхиле 1770   CB$(I):=""0""1780 ендпроц SCCOPY1790 //1800 //CSCOPY-COPY CB(I)... TO STRING S1810 //1820 проц CSCOPY(CB$,I,реф S$) цлосед1830   S$:=""1840   J:=11850   вхиле CB$(I)<>""0"" до1860     S$:+CB$(I)1870     I:+11880     1270       елсе 1280         RQUICK(I+1,HI)1290         RQUICK(LO,I-1)1300       ендиф 1310     ендиф 1320   ендпроц RQUICK1330 ендпроц QUICK1340 //1350 //GNAME-GENERATE UNIQUE NAME FOR FILE ID N1360 //1370 проц GNAME(N,реф NAME$) цлосед1380  =труе ор NEXTPOS>=MAXCHARS-150 ор NLINES>=MAXLINES0880   ретурн DONE0890 ендфунц GTEXT0900 //0910 //PTEXT-OUTPUT TEXT LINES FROM LINEBUF0920 //0930 проц PTEXT(LINEPOS(),NLINES,LINEBUF$,OUTFILE) цлосед0931   принт "PTEXT"0940   импорт PUTCF0950  =11980   J:=2*I1990   вхиле J<=NF до2000     иф J<NF тхен //FIND SMALLER CHILD2010       иф CMP(LINEPOS(J),LINEPOS(J+1),LINEBUF$)>0 тхен J:+12020     ендиф 2030     иф CMP(LINEPOS(I),LINEPOS(J),LINEBUF$)<=0 тхен2040       I:=NF //PROPER POSITION FMUSTCREATE(NAME$,1)1480 ендфунц MAKEFILE1490 //1500 //GOPEN-OPEN GROUP OF FILES F1..F21510 //1520 проц GOPEN(реф INFILE(),F1,F2) цлосед1521   принт "GOPEN";F1;F21530   импорт GNAME,MUSTOPEN1540   дим NAME$ оф 1501550   фор I:=1 то F2-F1+1 до156K(реф LINEPOS(),NLINES,LINEBUF$) цлосед1061   принт "QUICK"1080   RQUICK(1,NLINES)1090   //1100   //RQUICK-RECURSIVE QUICKSORT1110   //1120   проц RQUICK(LO,HI) цлосед1121     //принт "RQUICK";LO;HI1130     импорт CMP,EXCHANGE,LINEPOS(),LINEBUF$ LP2) цлосед0631   //принт "EXCHANGE";LP1;LP20640   TEMP:=LP10650   LP1:=LP20660   LP2:=TEMP0670 ендпроц EXCHANGE0680 //0690 //GTEXT-GET TEXT LINES INTO LINEBUF0700 //0710 фунц GTEXT(реф LINEPOS(),реф NLINES,реф LINEBUF$,INFILE) цлосед0711   пр1650   фор I:=1 то F2-F1+1 до XREMOVE(INFILE(I))1660 ендпроц GREMOVE1670 //1680 //SCCOPY-COPY STRING S TO CB(I)...1690 //1700 проц SCCOPY(S$,реф CB$,I) цлосед1710   J:=11720   вхиле S$(J)<>""0"" до1730     CB$(I):=S$(J)1740     J:+11750     I:до J:-11210         иф I<J тхен EXCHANGE(LINEPOS(I),LINEPOS(J)) //OUT OF ORDER PAIR1220       унтил I>=J1230       EXCHANGE(LINEPOS(I),LINEPOS(HI)) //MOVE PIVOT TO I1240       иф I-LO<HI-I тхен1250         RQUICK(LO,I-1)1260         RQUICK(I+1,HI)LINES:+10810       LINEPOS(NLINES):=NEXTPOS0820       LLEN:=LENGTH(TEMP$)0830       фор I:=1 то LLEN до LINEBUF$(NEXTPOS+I-1):=TEMP$(I)0840       LINEBUF$(NEXTPOS+LLEN):=""0""0850       NEXTPOS:+LLEN+1 //1 FOR ""0""0860     ендиф 0870   унтил DONEJ:+11890   ендвхиле 1900   S$:+""0""1910 ендпроц CSCOPY1920 //1930 //REHEAP-PUT LINEBUF(LINEPOS(1)) IN PROPER PLACE IN HEAP1940 //1950 проц REHEAP(реф LINEPOS(),NF,LINEBUF$) цлосед1951   //принт "REHEAP-NF";NF1960   импорт CMP,EXCHANGE1970   I: NAME$:="STEMP"+стр$(N)+""0""1390 ендпроц GNAME1400 //1410 //MAKEFILE-MAKE NEW FILE FOR NUMBER N1420 //1430 фунц MAKEFILE(N) цлосед1431   принт "MAKEFILE";N1440   импорт MUSTCREATE,GNAME1450   дим NAME$ оф 1501460   GNAME(N,NAME$)1470   ретурн 	 фор I:=1 то NLINES до0960     J:=LINEPOS(I)0970     вхиле LINEBUF$(J)<>""0"" до0980       PUTCF(LINEBUF$(J),OUTFILE)0990       J:+11000     ендвхиле 1010   ендфор I1020 ендпроц PTEXT1030 //1040 //QUICK-QUICKSORT FOR LINES1050 //1060 проц QUIC OUND,TERMINATE LOOP2050     елсе 2060       EXCHANGE(LINEPOS(I),LINEPOS(J)) //PERCOLATE2070     ендиф 2080     I:=J2090     J:=2*I2100   ендвхиле 2110 ендпроц REHEAP2120 //2130 //MERGE-MERGE INFILE(1)..INFILE(NF) ONTO OUTFILE2140 //2150 проц M
ERGE(INFILE(),NF,OUTFILE) цлосед2151   принт "MERGE"2160   импорт REHEAP,SCCOPY,CSCOPY,GETLINE,QUICK,PUTSTR2170   импорт LINEPOS(),LINEBUF$2180   дим TEMP$ оф 1502190   J:=02200   фор I:=1 то NF до //GET ONE LINE FROM EACH FILE2210     иф GETLINE(програмECHO  ECHO ARGUMENTS TO OUTPUT усагеRUN "ECHO"$[ARGUMENT ...] [<STDIN] [>STDOUT] фунцтионECHO COPIES ITS COMMAND LINE ARGUMENTSTO ITS OUTPUT AS A LINE OF TEXT WITHONE SPACE BETWEEN EACH ARGUMENT.  иFTHERE ARE NO ARGUMENTS, NO OUTPUT ISONS. еьампле$DEFINE(ENDFILE,(-1))DEFINE(DONE,ENDFILE)   IF (GETIT(LINE) = DONE) THEN      PUTIT(SUMLINE)   ENDIF<ендфиле>    IF (GETIT(LINE) = (-1)) THEN      PUTIT(SUMLINE)   ENDIF бугса RECURSIVE DEFINITION SUCH AS:DEFINE(X,X)  ORDEFI QUICK(LINEPOS(),NF,LINEBUF$) //MAKE INITIAL HEAP2290   вхиле NF>0 до2300     LBP:=LINEPOS(1) //LOWEST LINE2310     CSCOPY(LINEBUF$,LBP,TEMP$)2311     //принт "PUTSTR FILE",OUTFILE;"FROM FILE",(LBP диж 150)+12320     PUTSTR(TEMP$,OUTFILE)2330     I OUTPUT GENERALLY CONTAINSFEWER CHARACTERS THAN THE INPUT.  а RUNOF X'S IS ENCODED AS ^NX, WHERE THECOUNT N IS A CHARACTER: 'а' CALLS FOR AREPETITION OF ONE X, 'б' A REPETITIONOF TWO X'S, AND SO ON.  рUNS LONGERTHAN 26 ARE BROKEN INTO SEVERAL SHORT └TTING OR INTERPRETATION OFTHE INPUT FILES, IT IS USEFUL FORDISPLAYING THE CONTENTS OF A FILE. еьамплетO EXAMINE A FILE:$FILE jNF:-12390     ендиф 2400     REHEAP(LINEPOS(),NF,LINEBUF$)2410   ендвхиле 2420 ендпроц MERGE2430 // PPRODUCED. еьамплетO SEE IF YOUR SYSTEM IS ALIVE:$HELLO WORLD!HELLO WORLD! └HO LINES TYPED AT YOUR TERMINAL:$HELLO THERE, ARE YOU LISTENING?HELLO THERE, ARE YOU LISTENING?YES, и AM.YES, и AM.<ендфиле>EQUENT OCCURRENCE OF IDENT REPLACEDBY STRING. STRING MUST BE BALANCED INPARENTHESES.  тHE TEXT OF EACHDEFINITION PROPER RESULTS IN NO OUTPUTTEXT.  EACH REPLACEMENT STRING ISRESCANNED FOR FURTHER POSSIBLEREPLACEMENTS, PERMITTING MULTI-LEVELDEFINITITEMP$,INFILE(I),150)=труе тхен2211       //принт "GETLINE FILE",INFILE(I)2220       LBP:=(I-1)*150+1 //ROOM FOR LONGEST2230       SCCOPY(TEMP$,LINEBUF$,LBP)2231       LINEPOS(I):=LBP2240       J:+12250     ендиф 2260   ендфор I2270   NF:=J2280  програмCOMPRESS  COMPRESS INPUT BY ENCODING          REPEATED CHARACTERS усагеRUN "COMPRESS"$[<STDIN] [>STDOUT] фунцтионCOMPRESS COPIES ITS INPUT TO ITS OUTPUTREPLACING STRINGS OF FOUR OR MOREIDENTICAL CHARACTERS BY A CODE SEQUENCESO THAT THEпрограмCONCAT  CONCATENATE FILES усагеRUN "CONCAT"$FILE ... [<STDIN] [>STDOUT] фунцтионCONCAT WRITES THE CONTENTS OF EACH OFITS FILE ARGUMENTS IN TURN TO ITSOUTPUT, THUS CONCATENATING THEM INTOONE LARGER FILE.  сINCE CONCAT PERFORMSNO REFORMA:=(LBP диж 150)+1 //COMPUTE FILE INDEX2340     иф GETLINE(TEMP$,INFILE(I),150)=труе тхен2341       //принт "GETLINE FILE",INFILE(I)2350       SCCOPY(TEMP$,LINEBUF$,LBP)2360     елсе //ONE LESS INPUT FILE2370       LINEPOS(1):=LINEPOS(NF)2380        ╟ERONES.  рUNS OF ^'S OF ANY LENGTH AREENCODED. еьампле$иTEM    нAME         жALUEиTEM^д нAME^и жALUE1       CAR          $7,000.00 ^1^г CAR^й $7,000.00 ^а^<ендфиле>програмCOPY  COPY INPUT TO OUTPUT усагеRUN "COPY"$[<STDIN] [>STDOUT] фунцтионCOPY COPIES ITS INPUT TO ITS OUTPUTUNCHANGED.  иT IS USEFUL FOR COPYINGFROM A TERMINAL TO A FILE, FROM A FILETO A FILE, AND FROM A FILE TO ATERMINAL. еьамплетO EC	програмDEFINE  EXPAND STRING DEFINITIONS усаге                                   RUN "DEFINE"$[<STDIN] [>STDOUT] фунцтионDEFINE READS IT INPUT, LOOKING FORMACRO DEFINITIONS OF THE FORM:   DEFINE(IDENT,STRING)AND WRITES ITS OUTPUT WITH EACHSUBS [NE(A,B) DEFINE(B,C) DEFINE(C,A)WILL CAUSE AN INFINITE LOOP WHENX, A, B OR C IS INVOKED. НпрограмLINECOUNT  COUNT LINES IN INPUT усагеRUN "LINECOUNT"$[<STDIN] [>STDOUT] фунцтионLINECOUNT COUNTS THE LINES IN ITS INPUTAND WRITES THE TOTAL AS A LINE OF TEXTTO ITS OUTPUT. еьампле$а SINGLE LINE OF INPUT.<ендфиле>1TERS WHICHARE ON ORDER, USING THE цбм асцииREPRESENTATION OF THE CHARACTERS.  иFA LINE IS A PROPER PREFIX OF ANOTHERLINE, IT PRECEDES THAT LINE IN THESORT ORDER. SORT WRITES INTERMEDIATE DATA TO FILESNAMED STEMP#, WHERE # IS A SMALLDECIMAL DIGITN) IS REPLACED BY THESUBSTRING OF S STARTING AT M (COUNTINGFROM ONE) AND CONTINUING AT MOST FORN CHARACTER.  иF N IS OMITTED, IT ISTAKEN AS A VERY LARGE NUMBER; IF M ISOUTSIDE THE STRING, THE REPLACEMENTSTRING IS NULL.  M AND N MAY BEEXPRESSIONS SENCE OF IDENT REPLACEDBY STRING. вITHIN A REPLACEMENT STRING, ANY $N,WHERE N IS A SINGLE DIGIT, IS REPLACEDBY AN ARGUMANT CORRESPONDING TO THATDIGIT.  аRGUMENTS ARE WRITTEN AS APARENTHESIZED LIST OF STRINGS FOLLOWINGAN INSTANCE OF THE IDENTIFIER,а HEADER CONSISTS OF TWO BLANK LINES,A LINE GIVING THE FILENAME AND PAGENUMBER, AND TWO MORE BLANK LINES; AFOOTER CONSISTS OF TWO BLANK LINES.пAGES FOR EACH FILE ARE NUMBERED FROMONE. еьамплетO PRINT MANUAL PAGES TO THE PRINTER:$>LP: M.PRINT M.AOSSIBLE REPLACEMENTS,PERMITTING MULTI-LEVEL DEFINITIONS TOBE EXPANDED TO FINAL FORM. еьамплетHE MACRO STRLEN COULD BE WRITTEN INTERMS OF THE OTHER BUILT-INS AS: DEFINE(STRLEN,!IFELSE($1,,0,!EXPR(1+STRLEN(SUBSTR($2,2)))#)#) бугса RECURSIVE DEFNOCCURS, EXCEPT THAT ANY SEQUENCE OFCHARACTERS BETWEEN ! AND A BALANCING #IS TAKEN LITERALLY, WITH THE ! AND #REMOVED.  тHUS IT IS POSSIBLE TO MAKEAN ALIAS FOR DEFINE BY WRITING   DEFINE(DEF,!DEFINE($1,$2)#) аDDITIONAL BUILT-INS ARE: ифелсе(A,B ╗ STRING; THESE FILENAMESSHOULD BE AVOIDED. еьамплетO PRINT THE SORTED OUTPUT OF A PROGRAMRUN "PROGRAM"$>TEMP1RUN "SORT"$<TEMP1 >TEMP2RUN "PRINT"$<TEMP2 >LP: програмTRANSLIT  TRANSLITERATE CHARACTERS усагеRUN "TRANSLIT"$[!]SRC [DEST] [<STDIN] [>STDOUT] фунцтионTRANSLIT MAPS ITS INPUT, ON A CHARACTERBY CHARACTER BASIS, AND WRITES THETRANSLATED VERSION TO ITS OUTPUT.  иNTHE SIMPLEST CASE, EACH CHARACUSTCONSIST OF PARENTHESES, INTEGEROPERANDS WRITTEN AS DECIMAL DIGITSTRINGS, AND THE OPERATORS +, -, *, /(INTEGER DIVISION), AND % (REMAINDER).*, /, % BIND TIGHTER THAN +, -, BUTPARENTHESES MAY BE USED TO ALTER THEORDER OF EVALUATION. субстр(S,M,програмMACRO  EXPAND STRING DEFINITIONS, WITH       ARGUMENTS усагеRUN "MACRO"$[<STDIN] [>STDOUT] фунцтионMACRO READS ITS INPUT, LOOKING FORMACRO DEFINITIONS OF THE FORM:   DEFINE(IDENT,STRING)AND WRITES ITS OUTPUT WITH EACHSUBSEQUENT OCCURRпрограмPRINT  PRINT FILES WITH HEADINGS усагеRUN "PRINT"$FILE ... [<STDIN] [>STDOUT] фунцтионPRINT COPIES EACH OF ITS ARGUMENT FILESIN TURN TO ITS OUTPUT, INSERTING PAGEHEADERS AND FOOTERS AND FILLING THELAST PAGE OF EACH FILE TO FULL LENGTH.UITABLE FOR EXPR. стрлен(S) IS REPLACED BY THE STRINGREPRESENTING THE LENGTH OF ITS ARGUMENTIN CHARACTERS. цхангея(XY) CHANGES THE QUOTE CHARS TOX AND Y.  CHANGEQ() CHANGES THEM BACKTO ! AND #. еACH REPLACEMENT STRING IS RESCANNEDFOR FURTHER P E.G.   IDENT(ARG1,ARG2,...) сO $1 IS REPLACED BY ARG1, $2 BY ARG2,AND SO ON; $0 IS REPLACED BY IDENT.мISSING ARGUMENTS ARE TAKEN AS NULLSTRINGS, EXTRA ARGUMENTS ARE IGNORED. тHE REPLACEMENT STRING IN A DEFINITIONIS EXPANDED BEFORE THE DEFINITIO RCHIVE M.COPY лINITION OF THE FORM:  DEFINE(X,X) OR  DEFINE(A,B) DEFINE(B,C) DEFINE(C,A)WILL CAUSE AN INFINITE LOOP.еXPRESSION EVALUATION IS FRAGILE, THEREIS NO UNARY MINUS.иT IS UNWISE TO USE () AS QUOTE CHARS.	,C,D) IS REPLACED BY THESTRING C IF STRING A EXACTLY MATCHESSTRING B; OTHERWISE IT IS REPLACED BYSTRING D. еьпр(EXPRESSION) IS REPLACED BY THEDECIMAL STRING REPRESENTATION OF THENUMERIC VALUE OF EXPRESSION.  фORCORRECT OPERATION, THE EXPRESSION MпрограмSORT  SORT TEXT LINES усагеRUN "SORT"$[<STDIN] [>STDOUT] фунцтионSORT SORTS ITS INPUT INTO ASCENDINGLEXICOGRAPHIC ORDER.  тWO LINES ARE INORDER IF THEY ARE IDENTICAL OR THELEFTMOST CHARACTER POSITION IN WHICHTHEY DIFFER CONTAINS CHARAC
TER INTHE ARGUMENT SRC IS TRANSLATED TO THECORRESPONDING CHARACTER IN THE ARGUMENTDEST; ALL OTHER CHARACTERS ARE COPIEDAS IS.  бOTH SRC AND DEST MAY CONTAINSUBSTRINGS OF THE FORM C1-C2 AS SHORT-HAND FOR ALL OF THE CHARACTERS IN THERANGE C1..C2.  CKKKHE LAST CHARACTER IN DEST;MOREOVER ADJACENT INSTANCES OF SUCHCHARACTERS IN THE INPUT ARE REPRESENTEDIN THE OUTPUT BY A SINGLE INSTANCE OFTHE LAST CHARACTER IN DEST.  тHUS   $0-9 9CONVERS EACH STRING OF DIGITS TO ASINGLE DIGIT 9. фINALLY, IF SRC KKK UTEST, I.E., ATEST OF TRANSLIT.тHIS IS A SIMPLE MINDED TEST I E A TESTOF TRANSLITK1 AND C2 MUST BE BOTHDIGITS, OR BOTH LETTERS OF THE SAMECASE. иF DEST IS ABSENT, ALL CHARACTERSREPRESENTED BY SRC ARE DELETED.  иFDEST IS SHORTER THAN SRC, ALLCHARACTERS IN SRC THAT WOULD MAP TO ORBEYOND THE LAST CHARACTER IN DEST AREMAPPED TO TKKKIS PRECEDED BY !, THENALL BUT THE CHARACTERS REPRESENTED BYSRC ARE TAKEN AS THE SOURCE STRING. еьамплетO CONVERT UPPER- TO LOWER-CASE:$а-з A-Z тO DISCARD PUNCTUATION AND ISOLATEWORDS BY SPACES ON EACH LINE:$!A-Zа-з@N @SтHIS IS A SIMPLE-MINDED KKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKK